#!/bin/bash

#----------------------------------------------------
# ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
#----------------------------------------------------

# üé® –¶–≤–µ—Ç–∞
RESET='\033[0m'
RED='\033[31m'
GREEN='\033[32m'
YELLOW='\033[33m'
BLUE='\033[34m'
CYAN='\033[36m'
GRAY='\033[90m'

# üé≤ –ë–∞–∑–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
HOME_DIR="$(cd "$HOME" && pwd)"
CURRENT_DIR="$(pwd -P)"
BASE_DIR="$HOME/.myshell"

# üóÑÔ∏è –ë—ç–∫–∞–ø –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
TIMESTAMP=$(date +"%Y-%m-%d_%H-%M-%S")
BACKUP_DIR="$BASE_DIR/backup"
DATED_BACKUP_DIR="$BACKUP_DIR/backup_$TIMESTAMP"

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
MAX_BACKUPS=10  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∫–æ–ø–∏–π (–Ω–µ –≤–∫–ª—é—á–∞—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é)
INITIAL_BACKUP_NAME="initial_backup"  # –ò–º—è –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏

# üßπ –®–∞–±–ª–æ–Ω—ã —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
TRASH=".zsh* .tmux* .vim* .oh-my-zsh*"

# üìÇ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
VIM_DIR="$BASE_DIR/vim"
VIM_COLORS_DIR="$VIM_DIR/colors"
VIM_PLUGINS_DIR="$VIM_DIR/plugins"

# üß© –ü–∞–∫–µ—Ç—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
PACKAGES="git curl zsh vim"

# üîó Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
GIT_DOTFILES_REPO="https://github.com/alexbic/dotfiles.git"
GIT_TMUX_REPO="https://github.com/gpakosz/.tmux.git"
GIT_OMZ_REPO="https://github.com/ohmyzsh/ohmyzsh.git"
GIT_OMZ_INSTALL_URL="https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh"

# üîó Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–ª–∞–≥–∏–Ω–æ–≤
GIT_ZSH_AUTOSUGGESTIONS_REPO="https://github.com/zsh-users/zsh-autosuggestions"
GIT_ZSH_SYNTAX_HIGHLIGHTING_REPO="https://github.com/zsh-users/zsh-syntax-highlighting"
GIT_VIM_PAPERCOLOR_REPO="https://github.com/NLKNguyen/papercolor-theme.git"

# üî£ –í–µ—Ä—Å–∏—è —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_VERSION="1.0.2"

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
ACTION=""
SAVE_EXISTING=""

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫
LOG_FILE="$HOME/.myshell_install_error.log"

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥-—Ñ–∞–π–ª–∞
> "$LOG_FILE"

#----------------------------------------------------
# üé® –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
#----------------------------------------------------

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥
log_error() {
  local message="$1"
  echo "$(date '+%Y-%m-%d %H:%M:%S') - ERROR: $message" >> "$LOG_FILE"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≥—Ä—É–ø–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
print_group_header() {
  local title="$1"
  echo -e "\n${BLUE}${title}${RESET}"
}

# –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏
print_message_with_dots() {
  local prefix="$1"      # –ü—Ä–µ—Ñ–∏–∫—Å —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "‚îî‚îÄ‚Üí" –∏–ª–∏ "‚ö†Ô∏è ")
  local message="$2"     # –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  local result="$3"      # –†–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è")
  local result_color="$4"  # –¶–≤–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (GREEN, CYAN, YELLOW, RED)
  local indent="$5"      # –û—Ç—Å—Ç—É–ø
  local width=80         # –û–±—â–∞—è —à–∏—Ä–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏
  local pfx_msg_length=${#prefix}
  local msg_length=${#message}
  local result_length=${#result}
  local total_length=$((pfx_msg_length + msg_length + 2)) # +2 –¥–ª—è –ø—Ä–æ–±–µ–ª–æ–≤
  local dots_count=$((width - total_length - result_length))
  
  # –í—ã–≤–æ–¥–∏–º –ø—Ä–µ—Ñ–∏–∫—Å –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Ç—Å—Ç—É–ø–æ–º
  echo -en "${indent}${BLUE}${prefix}${RESET} ${message}"
  
  # –í—ã–≤–æ–¥–∏–º —Ç–æ—á–∫–∏ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
  for ((i=1; i<=dots_count; i++)); do
    echo -en "${GRAY}.${RESET}"
    sleep 0.01
  done
  
  # –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º —Ü–≤–µ—Ç–µ
  echo -e " ${!result_color}${result}${RESET}"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏
print_operation() {
  print_message_with_dots "‚îî‚îÄ‚Üí" "$1" "$2" "$3" "  "
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)
print_info() {
  print_message_with_dots "‚îî‚îÄ‚Üí" "$1" "$2" "$3" "  "
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)
print_warning() {
  print_message_with_dots "‚îî‚îÄ‚Üí" "$1" "$2" "YELLOW" "  "
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)
print_success() {
  print_message_with_dots "‚îî‚îÄ‚Üí" "$1" "$2" "GREEN" "  "
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–∫–∏ (–≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)
print_error() {
  local message="$1"
  local result="$2"
  
  # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –ª–æ–≥
  log_error "$message: $result"
  
  # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  print_message_with_dots "‚îî‚îÄ‚Üí" "$message" "$result" "RED" "  "
}

# –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
center_text() {
  local text="$1"
  local width=70 # –®–∏—Ä–∏–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–º–∫–∏
  local padding=$(( (width - ${#text}) / 2 ))
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ padding
  if (( padding < 0 )); then
    padding=0
  fi
  
  printf "%${padding}s%s%${padding}s" "" "$text" ""
}

#----------------------------------------------------
# üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C)
#----------------------------------------------------

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏
cleanup_on_interrupt() {
  echo -e "\n${YELLOW}‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è. –í—ã–ø–æ–ª–Ω—è–µ–º –æ—á–∏—Å—Ç–∫—É...${RESET}"
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —É–¥–∞–ª—è–µ–º –µ—ë
  for tmp_dir in "$HOME/init-shell" "$BACKUP_DIR/tmp_extract" "$BACKUP_DIR/tmp_backup_before_restore"; do
    if [[ -d "$tmp_dir" ]]; then
      echo -e "${BLUE}üóëÔ∏è  –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é $tmp_dir...${RESET}"
      rm -rf "$tmp_dir" 2>/dev/null || sudo rm -rf "$tmp_dir"
    fi
  done
  
  echo -e "${GREEN}üëã –°–∫—Ä–∏–ø—Ç –ø—Ä–µ—Ä–≤–∞–Ω. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!${RESET}"
  exit 1
}

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–≤—É—à–∫—É –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
trap cleanup_on_interrupt SIGINT SIGTERM

#----------------------------------------------------
# üé® –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
#----------------------------------------------------

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ASCII-–ª–æ–≥–æ—Ç–∏–ø–∞ –≤ —Ü–≤–µ—Ç–∞—Ö —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ñ–ª–∞–≥–∞
show_logo() {
  # –¶–≤–µ—Ç–∞ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ñ–ª–∞–≥–∞
  WHITE='\033[97m'
  RU_BLUE='\033[34m'
  RU_RED='\033[31m'
  
  # –†–∏—Å—É–µ–º –ª–æ–≥–æ—Ç–∏–ø –≤ —Ü–≤–µ—Ç–∞—Ö —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ñ–ª–∞–≥–∞
  echo -e "${WHITE}"
  echo "  __  ____  _______ __  __________    __"
  echo -e "${RU_BLUE} /  |/  / |/ / ___// / / / ____/ /   / /"
  echo -e " / /|_/ /|   /\\__ \\/ /_/ / __/ / /   / /"
  echo -e "${RU_RED}/ /  / //   /___/ / __  / /___/ /___/ /___"
  echo -e "/_/  /_//_/|_/____/_/ /_/_____/_____/_____/${RESET}"
  echo -e ""
  echo -e "${BLUE}üí° –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è ${CYAN}Linux${RESET} (Debian)"

  echo -e "${WHITE}Zsh + Oh-My-Zsh${RESET} ${RU_BLUE}Tmux${RESET} ${RU_RED}Vim${RESET} " 

  echo -e "${BLUE}üì¶ Version: ${YELLOW}$SCRIPT_VERSION${RESET}"
  echo -e "${BLUE}üîó https://github.com/alexbic/init-shell${RESET}\n"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
show_config_info() {
  echo -e "\n${BLUE}üîç –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:${RESET}\n"
  
  if [[ -d "$BASE_DIR" ]]; then
    echo -e "  ${GREEN}‚úÖ –û–∫—Ä—É–∂–µ–Ω–∏–µ ${CYAN}MYSHELL${GREEN} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ${RESET}"
    
    local base_version=""
    if [[ -f "$BASE_DIR/version" ]]; then
      base_version=$(cat "$BASE_DIR/version")
      echo -e "  ${BLUE}‚ÑπÔ∏è  –í–µ—Ä—Å–∏—è:${RESET} $base_version"
    else
      echo -e "  ${YELLOW}‚ö†Ô∏è –í–µ—Ä—Å–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞${RESET}"
    fi
    
    local install_date=""
    if [[ -d "$BASE_DIR" ]]; then
      install_date=$(stat -c %y "$BASE_DIR" 2>/dev/null | cut -d' ' -f1)
      echo -e "  ${BLUE}üìÖ –î–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:${RESET} $install_date"
    fi
    
    echo -e "\n  ${BLUE}üìã –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:${RESET}"
    
    [[ -d "$BASE_DIR/ohmyzsh" ]] && 
      echo -e "  ${GREEN}‚úÖ Oh-My-Zsh${RESET}" || 
      echo -e "  ${RED}‚ùå Oh-My-Zsh${RESET}"
      
    [[ -d "$BASE_DIR/tmux" ]] && 
      echo -e "  ${GREEN}‚úÖ Tmux${RESET}" || 
      echo -e "  ${RED}‚ùå Tmux${RESET}"
      
    [[ -d "$BASE_DIR/vim" ]] && 
      echo -e "  ${GREEN}‚úÖ Vim${RESET}" || 
      echo -e "  ${RED}‚ùå Vim${RESET}"
      
    [[ -d "$BASE_DIR/dotfiles" ]] && 
      echo -e "  ${GREEN}‚úÖ Dotfiles${RESET}" || 
      echo -e "  ${RED}‚ùå Dotfiles${RESET}"
  else
    print_warning "–û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL" "–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
    
    echo -e "  ${BLUE}üîé –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤–Ω–µ—à–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:${RESET}"
    
    [[ -f "$HOME/.zshrc" || -d "$HOME/.oh-my-zsh" ]] && 
      echo -e "  ${GREEN}‚úÖ Zsh/Oh-My-Zsh${RESET}" || 
      echo -e "  ${GRAY}‚ùå Zsh/Oh-My-Zsh${RESET}"
      
    [[ -f "$HOME/.tmux.conf" ]] && 
      echo -e "  ${GREEN}‚úÖ Tmux${RESET}" || 
      echo -e "  ${GRAY}‚ùå Tmux${RESET}"
      
    [[ -f "$HOME/.vimrc" || -d "$HOME/.vim" ]] && 
      echo -e "  ${GREEN}‚úÖ Vim${RESET}" || 
      echo -e "  ${GRAY}‚ùå Vim${RESET}"
  fi
  
  echo ""
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
get_action_description() {
  case $ACTION in
    "update") echo "üîÑ –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏" ;;
    "reinstall") 
      if [[ "$SAVE_EXISTING" == "y" ]]; then
        echo "üîÅ –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤–∞—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"
      else
        echo "üÜï –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã)"
      fi
      ;;
    "install")
      if [[ "$SAVE_EXISTING" == "y" ]]; then
        echo "üîê –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"
      else
        echo "üì• –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —á–∏—Å—Ç–æ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã)"
      fi
      ;;
    "plugins") echo "üß© –ü–ª–∞–≥–∏–Ω—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è MYSHELL –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π" ;;
    "backup") echo "üíæ –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è MYSHELL" ;;
    *) echo "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ" ;;
  esac
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
show_environment_status() {
  local result=""
  
  if [[ -d "$BASE_DIR" ]]; then
    result="${result}${GREEN}‚úì –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ${RESET}\n"
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏
    if [[ -f "$BASE_DIR/version" ]]; then
      local version=$(cat "$BASE_DIR/version")
      result="${result}${GREEN}‚úì –í–µ—Ä—Å–∏—è: $version${RESET}\n"
    else
      result="${result}${YELLOW}‚ö†Ô∏è –í–µ—Ä—Å–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞${RESET}\n"
    fi
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
    result="${result}${BLUE}üìã –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:${RESET}\n"
    [[ -d "$BASE_DIR/ohmyzsh" ]] && result="${result}  ${GREEN}‚úì Oh-My-Zsh${RESET}\n" || result="${result}  ${RED}‚úó Oh-My-Zsh (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)${RESET}\n"
    [[ -d "$BASE_DIR/tmux" ]] && result="${result}  ${GREEN}‚úì Tmux${RESET}\n" || result="${result}  ${RED}‚úó Tmux (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)${RESET}\n"
    [[ -d "$BASE_DIR/vim" ]] && result="${result}  ${GREEN}‚úì Vim${RESET}\n" || result="${result}  ${RED}‚úó Vim (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)${RESET}\n"
    [[ -d "$BASE_DIR/dotfiles" ]] && result="${result}  ${GREEN}‚úì Dotfiles${RESET}\n" || result="${result}  ${RED}‚úó Dotfiles (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)${RESET}\n"
  else
    result="${result}${YELLOW}‚ö†Ô∏è –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ${RESET}\n"
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö
    result="${result}${BLUE}üìã –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:${RESET}\n"
    [[ -f "$HOME/.zshrc" || -d "$HOME/.oh-my-zsh" ]] && result="${result}  ${GREEN}‚úì Zsh/Oh-My-Zsh${RESET}\n" || result="${result}  ${GRAY}‚úó Zsh/Oh-My-Zsh${RESET}\n"
    [[ -f "$HOME/.tmux.conf" ]] && result="${result}  ${GREEN}‚úì Tmux${RESET}\n" || result="${result}  ${GRAY}‚úó Tmux${RESET}\n"
    [[ -f "$HOME/.vimrc" || -d "$HOME/.vim" ]] && result="${result}  ${GREEN}‚úì Vim${RESET}\n" || result="${result}  ${GRAY}‚úó Vim${RESET}\n"
  fi
  
  echo -e "$result"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏—è—Ö
show_backup_info() {
  local result=""
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏
  if [[ -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" || -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]]; then
    result="${result}${GREEN}‚úì –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è (–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MYSHELL)${RESET}\n"
  else
    result="${result}${YELLOW}‚ö†Ô∏è –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç${RESET}\n"
  fi
  
  # –ü–æ–¥—Å—á–µ—Ç –æ–±—ã—á–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
  local backup_count=0
  local latest_backup=""
  
  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—ç–∫–∞–ø–æ–≤
  if [[ -d "$BACKUP_DIR" ]]; then
    while IFS= read -r dir; do
      dir_name=$(basename "$dir")
      if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" == backup_* ]]; then
        backup_count=$((backup_count + 1))
        latest_backup="$dir_name"
      fi
    done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
    
    # –ê—Ä—Ö–∏–≤—ã –±—ç–∫–∞–ø–æ–≤
    while IFS= read -r archive; do
      archive_name=$(basename "$archive" .tar.gz)
      if [[ -f "$archive" && "$archive_name" != "$INITIAL_BACKUP_NAME" && "$archive_name" == backup_* ]]; then
        backup_count=$((backup_count + 1))
      fi
    done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -name "*.tar.gz" 2>/dev/null || echo "")
  fi
  
  if [[ $backup_count -gt 0 ]]; then
    result="${result}${GREEN}‚úì –ù–∞–π–¥–µ–Ω–æ $backup_count —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π${RESET}\n"
    [[ -n "$latest_backup" ]] && result="${result}${GREEN}‚úì –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–ø–∏—è: $latest_backup${RESET}\n"
  else
    result="${result}${YELLOW}‚ö†Ô∏è –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç${RESET}\n"
  fi
  
  echo -e "$result"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
check_disk_space() {
  local target_dir="$1"
  local required_space="$2" # –≤ –ú–ë
  
  # –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –±–∞–π—Ç–∞—Ö –∏ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –ú–ë
  local available_space
  available_space=$(df -P "$(dirname "$target_dir")" | awk 'NR==2 {print $4}')
  available_space=$((available_space / 1024)) # –ü–µ—Ä–µ–≤–æ–¥ –≤ –ú–ë
  
  if [[ $available_space -lt $required_space ]]; then
    return 1 # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞
  else
    return 0 # –ú–µ—Å—Ç–æ –µ—Å—Ç—å
  fi
}

# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
manage_backups() {
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $BACKUP_DIR –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –µ—ë –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
  if [[ ! -d "$BACKUP_DIR" ]]; then
    if ! mkdir -p "$BACKUP_DIR"; then
      if sudo mkdir -p "$BACKUP_DIR"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "–æ—à–∏–±–∫–∞"
        return 1
      fi
    fi
  fi
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è
  local has_initial_backup=$([[ -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" || -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]] && echo "true" || echo "false")
  
  # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if [[ "$ACTION" == "install" && "$has_initial_backup" == "false" ]]; then
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    if ! check_disk_space "$BACKUP_DIR" 500; then
      print_warning "–ú–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –±—ç–∫–∞–ø–∞"
      return 0
    fi
    
    # –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
    if ! mkdir -p "$BACKUP_DIR/$INITIAL_BACKUP_NAME"; then
      if sudo mkdir -p "$BACKUP_DIR/$INITIAL_BACKUP_NAME"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏" "–æ—à–∏–±–∫–∞"
        return 1
      fi
    fi
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    local found_configs=false
    
    for item in $TRASH; do
      for target in $HOME/$item; do
        if [[ -e "$target" || -L "$target" ]]; then
          found_configs=true
          # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
          if [[ -L "$target" ]]; then
            # –î–ª—è —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—É—é —Å—Å—ã–ª–∫—É, —Ç–∞–∫ –∏ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            local link_target=$(readlink -f "$target")
            local base_name=$(basename "$target")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Å—ã–ª–∫–µ
            echo "SYMLINK: $target -> $link_target" > "$BACKUP_DIR/$INITIAL_BACKUP_NAME/${base_name}.symlink_info"
            
            # –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if [[ -e "$link_target" ]]; then
              if [[ -d "$link_target" ]]; then
                # –î–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º rsync –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                if ! rsync -a "$link_target/" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$base_name/"; then
                  if sudo rsync -a "$link_target/" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$base_name/"; then
                    print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Å—ã–ª–∫–∏ $base_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                  else
                    print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Å—ã–ª–∫–∏ $base_name" "–æ—à–∏–±–∫–∞"
                  fi
                else
                  print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Å—ã–ª–∫–∏ $base_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                fi
              else
                # –î–ª—è —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º cp —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                if ! cp -a "$link_target" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$base_name"; then
                  if sudo cp -a "$link_target" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$base_name"; then
                    print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ $base_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                  else
                    print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ $base_name" "–æ—à–∏–±–∫–∞"
                  fi
                else
                  print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ $base_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                fi
              fi
            else
              print_warning "–°—Å—ã–ª–∫–∞ $base_name —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—ä–µ–∫—Ç" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
            fi
          } else if [[ -d "$target" ]]; then
            # –î–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º rsync
            if ! rsync -a "$target/" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$(basename "$target")/"; then
              if sudo rsync -a "$target/" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/$(basename "$target")/"; then
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $(basename "$target")" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
                print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $(basename "$target")" "–æ—à–∏–±–∫–∞"
              fi
            else
              print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $(basename "$target")" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            fi
          else
            # –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            if ! cp -a "$target" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/"; then
              if sudo cp -a "$target" "$BACKUP_DIR/$INITIAL_BACKUP_NAME/"; then
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ $(basename "$target")" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
                print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ $(basename "$target")" "–æ—à–∏–±–∫–∞"
              fi
            else
              print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ $(basename "$target")" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            fi
          fi
        fi
      done
    done
    
    if $found_configs; then
      # –î–æ–±–∞–≤–ª—è–µ–º README –≤ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
      cat > "$BACKUP_DIR/$INITIAL_BACKUP_NAME/README.md" << EOF
# Initial backup of system configuration before MYSHELL installation
Created: $(date)
This backup contains the original system configuration and can be used to restore all settings if you decide to remove MYSHELL.

## Backed up files and directories:
$(find "$BACKUP_DIR/$INITIAL_BACKUP_NAME" -type f -not -path "*/\.*" | sort)
EOF
      
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π" "YELLOW"
      # –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, —Ç–∞–∫ –∫–∞–∫ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±—ã–ª–æ –Ω–µ—á–µ–≥–æ
      rm -rf "$BACKUP_DIR/$INITIAL_BACKUP_NAME"
    fi
  fi
  
  # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ã—á–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (–∏—Å–∫–ª—é—á–∞—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é)
  local backup_dirs=()
  while IFS= read -r dir; do
    dir_name=$(basename "$dir")
    # –ò—Å–∫–ª—é—á–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∏—â–µ–º —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "backup_"
    if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
      backup_dirs+=("$dir")
    fi
  done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
  
  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ –∏–º–µ–Ω–∏ (–æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏, –ø–æ—ç—Ç–æ–º—É —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞—Å—Ç –Ω–∞–º –ø–æ—Ä—è–¥–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
  IFS=$'\n' backup_dirs=($(for d in "${backup_dirs[@]}"; do echo "$d"; done | sort))
  unset IFS
  
  # –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π, –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ
  if [[ ${#backup_dirs[@]} -ge $MAX_BACKUPS ]]; then
    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
    local to_remove=$((${#backup_dirs[@]} - $MAX_BACKUPS + 1))  # +1 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–ø–∏–∏
    
    print_operation "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "$to_remove –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è" "YELLOW"
    
    # –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏
    for ((i=0; i<$to_remove; i++)); do
      local old_dir="${backup_dirs[$i]}"
      local dir_name=$(basename "$old_dir")
      local archive_path="$BACKUP_DIR/$dir_name.tar.gz"
      
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
      local dir_size=$(du -sm "$old_dir" | cut -f1)
      if ! check_disk_space "$BACKUP_DIR" $((dir_size + 100)); then
        print_warning "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $dir_name" "—É–¥–∞–ª—è–µ–º –±–µ–∑ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏"
        # –ü—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±–µ–∑ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
        if ! rm -rf "$old_dir"; then
          if sudo rm -rf "$old_dir"; then
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          else
            print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "–æ—à–∏–±–∫–∞"
          fi
        else
       print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        fi
        continue
      }
      
      # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
      if ! tar -czf "$archive_path" -C "$old_dir" .; then
        if sudo tar -czf "$archive_path" -C "$old_dir" .; then
          print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "–æ—à–∏–±–∫–∞"
          continue
        fi
      else
        print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
      
      # –£–¥–∞–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
      if ! rm -rf "$old_dir"; then
        if sudo rm -rf "$old_dir"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "–æ—à–∏–±–∫–∞"
        fi
      else
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    done
  fi
  
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
create_backup() {
  clear
  print_group_header "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell
  if [[ ! -d "$BASE_DIR" ]]; then
    echo -e "${RED}‚ùå –û–∫—Ä—É–∂–µ–Ω–∏–µ .myshell –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
  local myshell_size=$(du -sm "$BASE_DIR" | cut -f1)
  if ! check_disk_space "$BACKUP_DIR" $((myshell_size + 200)); then
    echo -e "${RED}‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.${RESET}"
    echo -e "${YELLOW}‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ $((myshell_size + 200)) –ú–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)
  manage_backups || return 1
  
  # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if ! mkdir -p "$BACKUP_DIR"; then
    if sudo mkdir -p "$BACKUP_DIR"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "–æ—à–∏–±–∫–∞"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
  else
    print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞
  if ! mkdir -p "$DATED_BACKUP_DIR"; then
    if sudo mkdir -p "$DATED_BACKUP_DIR"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "–æ—à–∏–±–∫–∞"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
  else
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ .myshell (–∫—Ä–æ–º–µ –ø–∞–ø–∫–∏ backup)
  if ! rsync -a --exclude 'backup/' "$BASE_DIR/" "$DATED_BACKUP_DIR/"; then
    if sudo rsync -a --exclude 'backup/' "$BASE_DIR/" "$DATED_BACKUP_DIR/"; then
      print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "–æ—à–∏–±–∫–∞"
      
      # –û—á–∏—Å—Ç–∫–∞ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
      rm -rf "$DATED_BACKUP_DIR" 2>/dev/null || sudo rm -rf "$DATED_BACKUP_DIR"
      
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
  else
    print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –°–æ–∑–¥–∞–µ–º README –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—ç–∫–∞–ø–∞
  cat > "$DATED_BACKUP_DIR/README.md" << EOF
# Backup of MYSHELL environment
Created: $(date)
Original directory: $BASE_DIR

## Contents:
$(find "$DATED_BACKUP_DIR" -type d -mindepth 1 -maxdepth 1 | sort | sed 's/^/- /')
EOF
  
  print_success "–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞" "$DATED_BACKUP_DIR"
  read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –±—ç–∫–∞–ø–æ–≤
archive_previous_backups() {
  print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–∞–ø–æ–∫ —Å –±—ç–∫–∞–ø–∞–º–∏" "–≤—ã–ø–æ–ª–Ω–µ–Ω–æ" "GREEN"
  
  # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø–∞–ø–∫–∏ –±—ç–∫–∞–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã
  local BACKUP_DIRS=()
  if [[ -d "$BACKUP_DIR" ]]; then
    while IFS= read -r dir; do
      dir_name=$(basename "$dir")
      # –ò—â–µ–º —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "backup_" –∏ –∏—Å–∫–ª—é—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ
      if [[ -d "$dir" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
        BACKUP_DIRS+=("$dir")
      fi
    done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
  fi
  
  # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–∞–ø–∫–∏ —Å –±—ç–∫–∞–ø–∞–º–∏, –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∏—Ö –≤—Å–µ
  if [[ ${#BACKUP_DIRS[@]} -gt 0 ]]; then
    print_operation "–ù–∞–π–¥–µ–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –±—ç–∫–∞–ø—ã" "${#BACKUP_DIRS[@]} –ø–∞–ø–æ–∫" "YELLOW"
    
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é –ø–∞–ø–∫—É
    for backup_dir in "${BACKUP_DIRS[@]}"; do
      dir_name=$(basename "$backup_dir")
      archive_path="$BACKUP_DIR/$dir_name.tar.gz"
      
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
      local dir_size=$(du -sm "$backup_dir" | cut -f1)
      if ! check_disk_space "$BACKUP_DIR" $((dir_size + 100)); then
        print_warning "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $dir_name" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
        continue
      fi
      
      if ! tar -czf "$archive_path" -C "$backup_dir" .; then
        if sudo tar -czf "$archive_path" -C "$backup_dir" .; then
          print_operation "–ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–∞–ø–∫—É $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–∞–ø–∫—É $dir_name" "–æ—à–∏–±–∫–∞"
          continue
        fi
      else
        print_operation "–ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–∞–ø–∫—É $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
      
      # –£–¥–∞–ª—è–µ–º –ø–∞–ø–∫—É –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
      if ! rm -rf "$backup_dir"; then
        if sudo rm -rf "$backup_dir"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $dir_name" "–æ—à–∏–±–∫–∞"
        fi
      else
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $dir_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    done
  else
    print_operation "–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –±—ç–∫–∞–ø—ã" "–Ω–µ –Ω–∞–π–¥–µ–Ω—ã" "GREEN"
  fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
archive_backup() {
  clear
  print_group_header "üóúÔ∏è –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π"
  
  # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –Ω–µ–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ø–∏–π
  local backup_dirs=()
  
  if [[ -d "$BACKUP_DIR" ]]; then
    while IFS= read -r dir; do
        dir_name=$(basename "$dir")
        if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
          local dir_date=$(stat -c %y "$dir" | cut -d' ' -f1)
          backup_dirs+=("$dir_name|$dir_date|dir")
        fi
      done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
  fi
  
  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ)
  IFS=$'\n' backup_dirs=($(for d in "${backup_dirs[@]}"; do
    local name=$(echo "$d" | cut -d'|' -f1)
    local date=$(echo "$d" | cut -d'|' -f2)
    local type=$(echo "$d" | cut -d'|' -f3)
    echo "$date|$name|$type"
  done | sort | awk -F'|' '{print $2"|"$1"|"$3}'))
  unset IFS
  
  # –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–ø–∏–π –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
  if [[ ${#backup_dirs[@]} -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –∫–æ–ø–∏–π –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
  echo -e "${CYAN}–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏:${RESET}\n"
  
  for ((i=0; i<${#backup_dirs[@]}; i++)); do
    local name=$(echo "${backup_dirs[$i]}" | cut -d'|' -f1)
    local date=$(echo "${backup_dirs[$i]}" | cut -d'|' -f2)
    echo -e "  ${CYAN}$((i+1)))${RESET} ${GREEN}$name${RESET} - $date"
  done
  
  echo -e "  ${CYAN}a)${RESET} ${YELLOW}–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏${RESET}"
  echo -e "  ${CYAN}0)${RESET} ${GRAY}–û—Ç–º–µ–Ω–∞${RESET}"
  
  # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  local max_choice=${#backup_dirs[@]}
  local choice=""
  
  while true; do
    read -p "üî¢ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ø–∏—é –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –∏–ª–∏ 'a' –¥–ª—è –≤—Å–µ—Ö [0-$max_choice/a]: " choice
    
    if [[ -z "$choice" ]]; then
      echo -e "${RED}‚ùå –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice –∏–ª–∏ 'a'.${RESET}"
    elif [[ "$choice" =~ ^[0-9]+$ && "$choice" -ge 0 && "$choice" -le "$max_choice" ]]; then
      break
    elif [[ "$choice" == "a" || "$choice" == "A" ]]; then
      break
    else
      echo -e "${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice –∏–ª–∏ 'a'.${RESET}"
    fi
  done
  
  # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ—Ç–º–µ–Ω–∞
  if [[ "$choice" -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 0
  fi
  
  # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏
  if [[ "$choice" == "a" || "$choice" == "A" ]]; then
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—Å–µ –∫–æ–ø–∏–∏
    print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
    
    local success_count=0
    local error_count=0
    
    for ((i=0; i<${#backup_dirs[@]}; i++)); do
      local name=$(echo "${backup_dirs[$i]}" | cut -d'|' -f1)
      local archive_path="$BACKUP_DIR/$name.tar.gz"
      
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
      local dir_size=$(du -sm "$BACKUP_DIR/$name" | cut -f1)
      if ! check_disk_space "$BACKUP_DIR" $((dir_size + 100)); then
        print_warning "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
        error_count=$((error_count + 1))
        continue
      fi
      
      # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∫–æ–ø–∏—é
      if ! tar -czf "$archive_path" -C "$BACKUP_DIR/$name" .; then
        if sudo tar -czf "$archive_path" -C "$BACKUP_DIR/$name" .; then
          print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          success_count=$((success_count + 1))
          
          # –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
          if ! rm -rf "$BACKUP_DIR/$name"; then
            if sudo rm -rf "$BACKUP_DIR/$name"; then
              print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            else
              print_error "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "–æ—à–∏–±–∫–∞"
            fi
          else
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          fi
        else
          print_error "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $name" "–æ—à–∏–±–∫–∞"
          error_count=$((error_count + 1))
        fi
      else
        print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        success_count=$((success_count + 1))
        
        # –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        if ! rm -rf "$BACKUP_DIR/$name"; then
          if sudo rm -rf "$BACKUP_DIR/$name"; then
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          else
            print_error "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "–æ—à–∏–±–∫–∞"
          fi
        else
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        fi
      fi
    done
    
    echo -e "\n${GREEN}‚úÖ –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${success_count} —É—Å–ø–µ—à–Ω–æ, ${error_count} —Å –æ—à–∏–±–∫–∞–º–∏${RESET}"
  else
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–ø–∏—é
    local selected_idx=$((choice-1))
    local selected_name=$(echo "${backup_dirs[$selected_idx]}" | cut -d'|' -f1)
    local archive_path="$BACKUP_DIR/$selected_name.tar.gz"
    
    print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ $selected_name" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    local dir_size=$(du -sm "$BACKUP_DIR/$selected_name" | cut -f1)
    if ! check_disk_space "$BACKUP_DIR" $((dir_size + 100)); then
      print_error "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "–æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
    
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–ø–∏—é
    if ! tar -czf "$archive_path" -C "$BACKUP_DIR/$selected_name" .; then
      if sudo tar -czf "$archive_path" -C "$BACKUP_DIR/$selected_name" .; then
        print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        
        # –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        if ! rm -rf "$BACKUP_DIR/$selected_name"; then
          if sudo rm -rf "$BACKUP_DIR/$selected_name"; then
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          else
            print_error "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "–æ—à–∏–±–∫–∞"
          fi
        else
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        fi
      else
        print_error "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $selected_name" "–æ—à–∏–±–∫–∞"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      
      # –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
      if ! rm -rf "$BACKUP_DIR/$selected_name"; then
        if sudo rm -rf "$BACKUP_DIR/$selected_name"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "–æ—à–∏–±–∫–∞"
        fi
      else
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    fi
    
    echo -e "\n${GREEN}‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è ${YELLOW}$selected_name${GREEN} —É—Å–ø–µ—à–Ω–æ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞${RESET}"
  fi
  
  read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
delete_backup() {
  clear
  print_group_header "üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π"
  
  # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–ø–∏–π (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π)
  local available_backups=()
  
  if [[ ! -d "$BACKUP_DIR" ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  while IFS= read -r dir; do
    dir_name=$(basename "$dir")
    if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
      local dir_date=$(stat -c %y "$dir" | cut -d' ' -f1)
      available_backups+=("$dir_name|$dir_date|dir|–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç $dir_date")
    fi
  done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
  
  # –ê—Ä—Ö–∏–≤—ã
  while IFS= read -r archive; do
    archive_name=$(basename "$archive" .tar.gz)
    if [[ -f "$archive" && "$archive_name" != "$INITIAL_BACKUP_NAME" && "$archive_name" == backup_* ]]; then
      local archive_date=$(stat -c %y "$archive" | cut -d' ' -f1)
      available_backups+=("$archive_name|$archive_date|archive|–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç $archive_date (–∞—Ä—Ö–∏–≤)")
    fi
  done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -name "*.tar.gz" 2>/dev/null || echo "")
  
  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ)
  IFS=$'\n' available_backups=($(for d in "${available_backups[@]}"; do
    local name=$(echo "$d" | cut -d'|' -f1)
    local date=$(echo "$d" | cut -d'|' -f2)
    local type=$(echo "$d" | cut -d'|' -f3)
    local desc=$(echo "$d" | cut -d'|' -f4)
    echo "$date|$name|$type|$desc"
  done | sort | awk -F'|' '{print $2"|"$1"|"$3"|"$4}'))
  unset IFS
  
  # –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
  if [[ ${#available_backups[@]} -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
  echo -e "${CYAN}–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:${RESET}\n"
  
  for ((i=0; i<${#available_backups[@]}; i++)); do
    local name=$(echo "${available_backups[$i]}" | cut -d'|' -f1)
    local date=$(echo "${available_backups[$i]}" | cut -d'|' -f2)
    local type=$(echo "${available_backups[$i]}" | cut -d'|' -f3)
    local desc=$(echo "${available_backups[$i]}" | cut -d'|' -f4)
    
    if [[ "$type" == "dir" ]]; then
      echo -e "  ${CYAN}$((i+1)))${RESET} ${GREEN}$desc${RESET} - $date"
    else
      echo -e "  ${CYAN}$((i+1)))${RESET} ${YELLOW}$desc${RESET} - $date"
    fi
  done
  
  echo -e "  ${CYAN}a)${RESET} ${RED}–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–ø–∏–∏${RESET}"
  echo -e "  ${CYAN}0)${RESET} ${GRAY}–û—Ç–º–µ–Ω–∞${RESET}"
  
  # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  local max_choice=${#available_backups[@]}
  local choice=""
  
  while true; do
    read -p "üî¢ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ø–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ 'a' –¥–ª—è –≤—Å–µ—Ö [0-$max_choice/a]: " choice
    
    if [[ -z "$choice" ]]; then
      echo -e "${RED}‚ùå –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice –∏–ª–∏ 'a'.${RESET}"
    elif [[ "$choice" =~ ^[0-9]+$ && "$choice" -ge 0 && "$choice" -le "$max_choice" ]]; then
      break
    elif [[ "$choice" == "a" || "$choice" == "A" ]]; then
      break
    else
      echo -e "${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice –∏–ª–∏ 'a'.${RESET}"
    fi
  done
  
  # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ—Ç–º–µ–Ω–∞
  if [[ "$choice" -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 0
  fi
  
  # –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏
  if [[ "$choice" == "a" || "$choice" == "A" ]]; then
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ–ø–∏–π
    echo -e "\n${RED}‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!${RESET} –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å ${RED}–í–°–ï${RESET} —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ (${#available_backups[@]} —à—Ç.)."
    read -p "–í—ã –ê–ë–°–û–õ–Æ–¢–ù–û —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–í–û–ó–ú–û–ñ–ù–û –æ—Ç–º–µ–Ω–∏—Ç—å! (–≤–≤–µ–¥–∏—Ç–µ 'yes'): " confirm
    
    if [[ "$confirm" != "yes" ]]; then
      echo -e "${YELLOW}‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.${RESET}"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 0
    fi
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–ø–∏–∏
    print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "RED"
    
    local success_count=0
    local error_count=0
    
    for ((i=0; i<${#available_backups[@]}; i++)); do
      local name=$(echo "${available_backups[$i]}" | cut -d'|' -f1)
      local type=$(echo "${available_backups[$i]}" | cut -d'|' -f3)
      
      if [[ "$type" == "dir" ]]; then
        # –£–¥–∞–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        if ! rm -rf "$BACKUP_DIR/$name"; then
          if sudo rm -rf "$BACKUP_DIR/$name"; then
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            success_count=$((success_count + 1))
          else
            print_error "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $name" "–æ—à–∏–±–∫–∞"
            error_count=$((error_count + 1))
          fi
        else
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          success_count=$((success_count + 1))
        fi
      else
        # –£–¥–∞–ª—è–µ–º –∞—Ä—Ö–∏–≤
        if ! rm -f "$BACKUP_DIR/$name.tar.gz"; then
          if sudo rm -f "$BACKUP_DIR/$name.tar.gz"; then
            print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $name.tar.gz" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            success_count=$((success_count + 1))
          else
            print_error "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $name.tar.gz" "–æ—à–∏–±–∫–∞"
            error_count=$((error_count + 1))
          fi
        else
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $name.tar.gz" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          success_count=$((success_count + 1))
        fi
      fi
    done
    
    echo -e "\n${GREEN}‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${success_count} —É—Å–ø–µ—à–Ω–æ, ${error_count} —Å –æ—à–∏–±–∫–∞–º–∏${RESET}"
  else
    # –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–ø–∏—é
    local selected_idx=$((choice-1))
    local selected_name=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f1)
    local selected_type=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f3)
    local selected_desc=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f4)
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    echo -e "\n${YELLOW}‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!${RESET} –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é:"
    echo -e "${GREEN}$selected_desc${RESET}"
    
    read -p "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å! (y/n): " confirm
    
    if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
      echo -e "${YELLOW}‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.${RESET}"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 0
    fi
    
    if [[ "$selected_type" == "dir" ]]; then
      # –£–¥–∞–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
      print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $selected_name" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
      
      if ! rm -rf "$BACKUP_DIR/$selected_name"; then
        if sudo rm -rf "$BACKUP_DIR/$selected_name"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $selected_name" "–æ—à–∏–±–∫–∞"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
          return 1
        fi
      else
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $selected_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    else
      # –£–¥–∞–ª—è–µ–º –∞—Ä—Ö–∏–≤
      print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $selected_name.tar.gz" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
      
      if ! rm -f "$BACKUP_DIR/$selected_name.tar.gz"; then
        if sudo rm -f "$BACKUP_DIR/$selected_name.tar.gz"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $selected_name.tar.gz" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $selected_name.tar.gz" "–æ—à–∏–±–∫–∞"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
          return 1
        fi
      else
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ $selected_name.tar.gz" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    fi
    
    echo -e "\n${GREEN}‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è ${YELLOW}$selected_desc${GREEN} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞${RESET}"
  fi
  
  read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
configure_backup() {
  clear
  print_group_header "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"
  
  # –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Ä–∞–º–∫–∏
  echo -e "${CYAN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${RESET}"
  echo -e "${CYAN}‚îÇ${RESET}               ${YELLOW}üîß –ù–ê–°–¢–†–û–ô–ö–ê –†–ï–ó–ï–†–í–ù–û–ì–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø${RESET}               ${CYAN}‚îÇ${RESET}"
  echo -e "${CYAN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${RESET}"
  echo -e ""

  # –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö —Ä–∞–º–æ–∫
  echo ""
  echo -e "  ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∫–æ–ø–∏–π: ${YELLOW}$MAX_BACKUPS${RESET}"
  echo -e "  ‚Ä¢ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: ${YELLOW}$BACKUP_DIR${RESET}"
  echo ""
  
  # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
  echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
  
  # –î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö —Ä–∞–º–æ–∫
  echo ""
  echo -e "  ${CYAN}1)${RESET} –ò–∑–º–µ–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –∫–æ–ø–∏–π"
  echo -e "  ${CYAN}2)${RESET} –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π"
  echo -e "  ${CYAN}0)${RESET} –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥"
  echo ""
  
  # –ù–∏–∂–Ω—è—è –ª–∏–Ω–∏—è —Ä–∞–º–∫–∏
  echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
  
  # –û—Ç—Å—Ç—É–ø –ø–æ—Å–ª–µ —Ä–∞–º–∫–∏
  echo ""
  
  # –ó–∞–ø—Ä–æ—Å –≤—ã–±–æ—Ä–∞
  local choice=""
  read -p "üî¢ –í–∞—à –≤—ã–±–æ—Ä [0-2]: " choice
  
  case $choice in
    1) # –ò–∑–º–µ–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π
      local new_max=""
      echo -e "\n${BLUE}üìä –¢–µ–∫—É—â–µ–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π: ${YELLOW}$MAX_BACKUPS${RESET}"
      
      while true; do
        read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (1-100, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 5-10): " new_max
        
        if [[ -z "$new_max" ]]; then
          echo -e "${RED}‚ùå –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100.${RESET}"
        elif [[ "$new_max" =~ ^[0-9]+$ && "$new_max" -ge 1 && "$new_max" -le 100 ]]; then
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if [[ ! -d "$BASE_DIR" ]]; then
            if ! mkdir -p "$BASE_DIR"; then
              if sudo mkdir -p "$BASE_DIR"; then
                print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
                print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
                read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
                return 1
              fi
            fi
          fi
          
          # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
          echo "MAX_BACKUPS=$new_max" > "$BASE_DIR/backup_config"
          MAX_BACKUPS=$new_max
          
          print_success "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π –∏–∑–º–µ–Ω–µ–Ω–æ" "$new_max"
          break
        else
          echo -e "${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100.${RESET}"
        fi
      done
      ;;
      
    2) # –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
      local new_dir=""
      echo -e "\n${BLUE}üìÇ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: ${YELLOW}$BACKUP_DIR${RESET}"
      echo -e "${YELLOW}‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!${RESET} –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ø–∏–∏."
      
      read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø—É—Ç—å (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π) –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–º–µ–Ω—ã: " new_dir
      
      if [[ -n "$new_dir" ]]; then
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—É—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
        if [[ "$new_dir" != /* ]]; then
          echo -e "${RED}‚ùå –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º (–Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å /).${RESET}"
        else
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if ! mkdir -p "$new_dir"; then
            if sudo mkdir -p "$new_dir"; then
              print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            else
              print_error "–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
              read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
              return 1
            fi
          else
            print_operation "–°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
          if ! touch "$new_dir/.test_write" &>/dev/null; then
            if sudo touch "$new_dir/.test_write" &>/dev/null; then
              sudo rm -f "$new_dir/.test_write"
              print_warning "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —ç—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é" "—Ç—Ä–µ–±—É—é—Ç—Å—è sudo –ø—Ä–∞–≤–∞"
            else
              print_error "–ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é" "–≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é"
              read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
              return 1
            fi
          else
            rm -f "$new_dir/.test_write"
          fi
          
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
          if ! sudo chown -R "$USER":"$USER" "$new_dir"; then
            print_warning "–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è sudo"
          else
            print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          fi
          
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .myshell, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if [[ ! -d "$BASE_DIR" ]]; then
            if ! mkdir -p "$BASE_DIR"; then
              if sudo mkdir -p "$BASE_DIR"; then
                print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
                print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
                read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
                return 1
              fi
            fi
          fi
          
          # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
          if [[ ! -f "$BASE_DIR/backup_config" ]]; then
            echo "MAX_BACKUPS=$MAX_BACKUPS" > "$BASE_DIR/backup_config"
          fi
          echo "BACKUP_DIR=$new_dir" >> "$BASE_DIR/backup_config"
          BACKUP_DIR=$new_dir
          DATED_BACKUP_DIR="$BACKUP_DIR/backup_$TIMESTAMP" # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É –±—ç–∫–∞–ø—É
          
          print_success "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –∏–∑–º–µ–Ω–µ–Ω–∞" "$new_dir"
        fi
      else
        echo -e "${YELLOW}‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.${RESET}"
      fi
      ;;
      
    0|"") # –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
      return 0
      ;;
      
    *) # –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä
      echo -e "${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä.${RESET}"
      ;;
  esac
  
  read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
restore_backup() {
  clear
  print_group_header "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"
  
  # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
  if [[ ! -d "$BACKUP_DIR" ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  local available_backups=()
  
  # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if [[ -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" ]]; then
    local initial_date=$(stat -c %y "$BACKUP_DIR/$INITIAL_BACKUP_NAME" | cut -d' ' -f1)
    available_backups+=("$INITIAL_BACKUP_NAME|$initial_date|dir|–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è (–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ MYSHELL)")
  elif [[ -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]]; then
    local initial_date=$(stat -c %y "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" | cut -d' ' -f1)
    available_backups+=("$INITIAL_BACKUP_NAME|$initial_date|archive|–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è (–∞—Ä—Ö–∏–≤)")
  fi
  
  # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
  while IFS= read -r dir; do
    dir_name=$(basename "$dir")
    if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
      local dir_date=$(stat -c %y "$dir" | cut -d' ' -f1)
      available_backups+=("$dir_name|$dir_date|dir|–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç $dir_date")
    fi
  done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
  
  # –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä—Ö–∏–≤—ã
  while IFS= read -r archive; do
    archive_name=$(basename "$archive" .tar.gz)
    if [[ -f "$archive" && "$archive_name" != "$INITIAL_BACKUP_NAME" && "$archive_name" == backup_* ]]; then
      local archive_date=$(stat -c %y "$archive" | cut -d' ' -f1)
      available_backups+=("$archive_name|$archive_date|archive|–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ç $archive_date (–∞—Ä—Ö–∏–≤)")
    fi
  done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -name "*.tar.gz" 2>/dev/null || echo "")
  
  # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
  IFS=$'\n' available_backups=($(for d in "${available_backups[@]}"; do
    local name=$(echo "$d" | cut -d'|' -f1)
    local date=$(echo "$d" | cut -d'|' -f2)
    local type=$(echo "$d" | cut -d'|' -f3)
    local desc=$(echo "$d" | cut -d'|' -f4)
    echo "$date|$name|$type|$desc"
  done | sort -r | awk -F'|' '{print $2"|"$1"|"$3"|"$4}'))
  unset IFS
  
  # –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–ø–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  if [[ ${#available_backups[@]} -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 1
  fi
  
  # –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–ø–∏–π
  echo -e "${CYAN}–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏:${RESET}\n"
  
  for ((i=0; i<${#available_backups[@]}; i++)); do
    local name=$(echo "${available_backups[$i]}" | cut -d'|' -f1)
    local date=$(echo "${available_backups[$i]}" | cut -d'|' -f2)
    local type=$(echo "${available_backups[$i]}" | cut -d'|' -f3)
    local desc=$(echo "${available_backups[$i]}" | cut -d'|' -f4)
    
    if [[ "$type" == "dir" ]]; then
      echo -e "  ${CYAN}$((i+1)))${RESET} ${GREEN}$desc${RESET} - $date"
    else
      echo -e "  ${CYAN}$((i+1)))${RESET} ${YELLOW}$desc${RESET} - $date"
    fi
  done
  
  echo -e "  ${CYAN}0)${RESET} ${GRAY}–û—Ç–º–µ–Ω–∞${RESET}"
  
  # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  local max_choice=${#available_backups[@]}
  local choice=""
  
  while true; do
    read -p "üî¢ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ø–∏—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è [0-$max_choice]: " choice
    
    if [[ -z "$choice" ]]; then
      echo -e "${RED}‚ùå –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice.${RESET}"
    elif [[ "$choice" =~ ^[0-9]+$ && "$choice" -ge 0 && "$choice" -le "$max_choice" ]]; then
      break
    else
      echo -e "${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ $max_choice.${RESET}"
    fi
  done
  
  # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ—Ç–º–µ–Ω–∞
  if [[ "$choice" -eq 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 0
  fi
  
  # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–ø–∏–∏
  local selected_idx=$((choice-1))
  local selected_name=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f1)
  local selected_type=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f3)
  local selected_desc=$(echo "${available_backups[$selected_idx]}" | cut -d'|' -f4)

  # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  echo -e "\n${YELLOW}‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!${RESET} –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –∑–∞–º–µ–Ω–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
  echo -e "–í—ã –≤—ã–±—Ä–∞–ª–∏: ${GREEN}$selected_desc${RESET}"
  
  read -p "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " confirm
  
  if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.${RESET}"
    read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
    return 0
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell
  if [[ ! -d "$BASE_DIR" ]]; then
    if ! mkdir -p "$BASE_DIR"; then
      if sudo mkdir -p "$BASE_DIR"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    fi
  fi
  
  # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  local tmp_backup_dir="$BACKUP_DIR/tmp_backup_before_restore"
  print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
  
  # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if [[ -d "$tmp_backup_dir" ]]; then
    if ! rm -rf "$tmp_backup_dir"; then
      if sudo rm -rf "$tmp_backup_dir"; then
        print_operation "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    fi
  fi
  
  # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–∞
  if ! mkdir -p "$tmp_backup_dir"; then
    if sudo mkdir -p "$tmp_backup_dir"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
  fi
  
  # –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
  if [[ -d "$BASE_DIR" && "$(find "$BASE_DIR" -mindepth 1 -not -path "$BACKUP_DIR*" -print -quit 2>/dev/null)" ]]; then
    if ! rsync -a --exclude 'backup/' "$BASE_DIR/" "$tmp_backup_dir/"; then
      if sudo rsync -a --exclude 'backup/' "$BASE_DIR/" "$tmp_backup_dir/"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "–æ—à–∏–±–∫–∞"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ç–∫–∞–ø–∞" "YELLOW"
  fi
  
  # –ü—Ä–æ—Ü–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–ø–∏–∏
  if [[ "$selected_type" == "dir" ]]; then
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    print_operation "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $selected_name" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–ø–∏–∏
    if [[ ! -d "$BACKUP_DIR/$selected_name" ]]; then
      print_error "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è $selected_name" "–Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
      
      # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      if [[ -d "$tmp_backup_dir" && "$(find "$tmp_backup_dir" -mindepth 1 -print -quit 2>/dev/null)" ]]; then
        print_operation "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        if ! rsync -a "$tmp_backup_dir/" "$BASE_DIR/"; then
          sudo rsync -a "$tmp_backup_dir/" "$BASE_DIR/"
        fi
      fi
      
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
    
    # –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .myshell (–∫—Ä–æ–º–µ backup)
    if ! find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 rm -rf 2>/dev/null; then
      if sudo find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 sudo rm -rf; then
        print_operation "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
        print_error "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ" "–æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
    if ! rsync -a "$BACKUP_DIR/$selected_name/" "$BASE_DIR/"; then
      if sudo rsync -a "$BACKUP_DIR/$selected_name/" "$BASE_DIR/"; then
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏
        print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–æ—à–∏–±–∫–∞"
        print_operation "–û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        
        if [[ -d "$tmp_backup_dir" && "$(find "$tmp_backup_dir" -mindepth 1 -print -quit 2>/dev/null)" ]]; then
          if ! rsync -a "$tmp_backup_dir/" "$BASE_DIR/"; then
            sudo rsync -a "$tmp_backup_dir/" "$BASE_DIR/"
          fi
        fi
        
        print_error "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ" "–æ—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞—Ä—Ö–∏–≤–∞
    print_operation "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞—Ä—Ö–∏–≤–∞ $selected_name.tar.gz" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞—Ä—Ö–∏–≤–∞
    if [[ ! -f "$BACKUP_DIR/$selected_name.tar.gz" ]]; then
      print_error "–ê—Ä—Ö–∏–≤ $selected_name.tar.gz" "–Ω–µ –Ω–∞–π–¥–µ–Ω"
      
      # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      if [[ -d "$tmp_backup_dir" && "$(find "$tmp_backup_dir" -mindepth 1 -print -quit 2>/dev/null)" ]]; then
        print_operation "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        if ! rsync -a "$tmp_backup_dir/" "$BASE_DIR/"; then
          sudo rsync -a "$tmp_backup_dir/" "$BASE_DIR/"
        fi
      fi
      
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      return 1
    fi
    
    # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ –∞—Ä—Ö–∏–≤–∞
    local extract_dir="$BACKUP_DIR/tmp_extract"
    
    # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if [[ -d "$extract_dir" ]]; then
      if ! rm -rf "$extract_dir"; then
        if sudo rm -rf "$extract_dir"; then
          print_operation "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
          return 1
        fi
      fi
    fi
    
    if ! mkdir -p "$extract_dir"; then
      if sudo mkdir -p "$extract_dir"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏" "–æ—à–∏–±–∫–∞"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤
    if ! tar -xzf "$BACKUP_DIR/$selected_name.tar.gz" -C "$extract_dir"; then
      if sudo tar -xzf "$BACKUP_DIR/$selected_name.tar.gz" -C "$extract_dir"; then
        print_operation "–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞" "–æ—à–∏–±–∫–∞"
        
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        rm -rf "$extract_dir" 2>/dev/null || sudo rm -rf "$extract_dir"
        
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .myshell (–∫—Ä–æ–º–µ backup)
    if ! find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 rm -rf 2>/dev/null; then
      if sudo find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 sudo rm -rf; then
        print_operation "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
        print_error "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ" "–æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ"
        
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        rm -rf "$extract_dir" 2>/dev/null || sudo rm -rf "$extract_dir"
        
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –ö–æ–ø–∏—Ä—É–µ–º —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    if ! rsync -a "$extract_dir/" "$BASE_DIR/"; then
      if sudo rsync -a "$extract_dir/" "$BASE_DIR/"; then
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏
        print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤" "–æ—à–∏–±–∫–∞"
        print_operation "–û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        
        if [[ -d "$tmp_backup_dir" && "$(find "$tmp_backup_dir" -mindepth 1 -print -quit 2>/dev/null)" ]]; then
          if ! rsync -a "$tmp_backup_dir/" "$BASE_DIR/"; then
            sudo rsync -a "$tmp_backup_dir/" "$BASE_DIR/"
          fi
        fi
        
        print_error "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ" "–æ—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏"
        
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        rm -rf "$extract_dir" 2>/dev/null || sudo rm -rf "$extract_dir"
        
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        return 1
      fi
    else
      print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏
    if ! rm -rf "$extract_dir"; then
      if sudo rm -rf "$extract_dir"; then
        print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_warning "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
      fi
    else
      print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  fi
  
  # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
  if ! rm -rf "$tmp_backup_dir"; then
    if sudo rm -rf "$tmp_backup_dir"; then
      print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_warning "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "–æ—à–∏–±–∫–∞"
    fi
  else
    print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
  if ! sudo chown -R "$USER":"$USER" "$BASE_DIR"; then
    print_warning "–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
  else
    print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏
  update_symlinks
  
  print_success "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "—É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
  echo -e "${GREEN}‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏: ${YELLOW}$selected_desc${RESET}"
  read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
  return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
update_symlinks() {
  local any_error=false
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
  if [[ -d "$BASE_DIR/dotfiles" && -f "$BASE_DIR/dotfiles/.zshrc" ]]; then
    if ! ln -sf "$BASE_DIR/dotfiles/.zshrc" "$HOME/.zshrc"; then
      if sudo ln -sf "$BASE_DIR/dotfiles/.zshrc" "$HOME/.zshrc"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .zshrc" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .zshrc" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .zshrc" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .zshrc" "–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    any_error=true
  fi
  
  if [[ -d "$BASE_DIR/tmux" && -f "$BASE_DIR/tmux/.tmux.conf" ]]; then
    if ! ln -sf "$BASE_DIR/tmux/.tmux.conf" "$HOME/.tmux.conf"; then
      if sudo ln -sf "$BASE_DIR/tmux/.tmux.conf" "$HOME/.tmux.conf"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf" "–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    any_error=true
  fi
  
  if [[ -d "$BASE_DIR/dotfiles" && -f "$BASE_DIR/dotfiles/.tmux.conf.local" ]]; then
    if ! ln -sf "$BASE_DIR/dotfiles/.tmux.conf.local" "$HOME/.tmux.conf.local"; then
      if sudo ln -sf "$BASE_DIR/dotfiles/.tmux.conf.local" "$HOME/.tmux.conf.local"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf.local" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf.local" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf.local" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .tmux.conf.local" "–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    any_error=true
  fi
  
  if [[ -d "$BASE_DIR/dotfiles" && -f "$BASE_DIR/dotfiles/.vimrc" ]]; then
    if ! ln -sf "$BASE_DIR/dotfiles/.vimrc" "$HOME/.vimrc"; then
      if sudo ln -sf "$BASE_DIR/dotfiles/.vimrc" "$HOME/.vimrc"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vimrc" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vimrc" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vimrc" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vimrc" "–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    any_error=true
  fi
  
  if [[ -d "$BASE_DIR/vim" ]]; then
    if ! ln -sfn "$BASE_DIR/vim" "$HOME/.vim"; then
      if sudo ln -sfn "$BASE_DIR/vim" "$HOME/.vim"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vim" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .vim" "–∏—Å—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    any_error=true
  fi
  
  if [[ -d "$BASE_DIR/ohmyzsh" ]]; then
    if ! ln -sfn "$BASE_DIR/ohmyzsh" "$HOME/.oh-my-zsh"; then
      if sudo ln -sfn "$BASE_DIR/ohmyzsh" "$HOME/.oh-my-zsh"; then
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .oh-my-zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .oh-my-zsh" "–æ—à–∏–±–∫–∞"
        any_error=true
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .oh-my-zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    print_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ .oh-my-zsh" "–∏—Å—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    any_error=true
  fi
  
  if $any_error; then
    print_warning "–ù–µ –≤—Å–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã" "–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥"
    return 1
  else
    print_success "–í—Å–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã" "—É—Å–ø–µ—à–Ω–æ"
    return 0
  fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–µ–Ω—é —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
backup_menu() {
  local choice=""
  
  while true; do
    clear
    show_logo
    
    # –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Ä–∞–º–∫–∏ - —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω—è—è –ª–∏–Ω–∏—è
    echo -e "${CYAN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${RESET}"
    echo -e "${CYAN}‚îÇ${RESET}               ${YELLOW}–£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ó–ï–†–í–ù–´–ú–ò –ö–û–ü–ò–Ø–ú–ò${RESET}               ${CYAN}‚îÇ${RESET}"
    echo -e "${CYAN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${RESET}"
    echo -e ""
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏—è—Ö –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö —Ä–∞–º–æ–∫
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
    if [[ ! -d "$BACKUP_DIR" ]]; then
      echo -e "${YELLOW}‚ö†Ô∏è  –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç${RESET}"
      echo -e "${YELLOW}‚ö†Ô∏è  –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é${RESET}"
    else
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏
      if [[ -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" ]]; then
        local initial_date=$(stat -c %y "$BACKUP_DIR/$INITIAL_BACKUP_NAME" | cut -d' ' -f1)
        echo -e "${GREEN}‚úì –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è${RESET} - $initial_date"
      elif [[ -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]]; then
        local initial_date=$(stat -c %y "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" | cut -d' ' -f1)
        echo -e "${GREEN}‚úì –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è${RESET} - $initial_date (–∞—Ä—Ö–∏–≤)"
      fi
      
      # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ã—á–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
      local backup_dirs=()
      while IFS= read -r dir; do
        dir_name=$(basename "$dir")
        if [[ -d "$dir" && "$dir_name" != "$INITIAL_BACKUP_NAME" && "$dir_name" != "tmp_"* && "$dir_name" == backup_* ]]; then
          local dir_date=$(stat -c %y "$dir" | cut -d' ' -f1)
          backup_dirs+=("$dir_name|$dir_date|dir")
        fi
      done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null || echo "")
      
      # –î–æ–±–∞–≤–ª—è–µ–º –∞—Ä—Ö–∏–≤—ã
      while IFS= read -r archive; do
        archive_name=$(basename "$archive" .tar.gz)
        if [[ -f "$archive" && "$archive_name" != "$INITIAL_BACKUP_NAME" && "$archive_name" == backup_* ]]; then
          local archive_date=$(stat -c %y "$archive" | cut -d' ' -f1)
          backup_dirs+=("$archive_name|$archive_date|archive")
        fi
      done < <(find "$BACKUP_DIR" -mindepth 1 -maxdepth 1 -name "*.tar.gz" 2>/dev/null || echo "")
      
      # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–ø–∏–∏ –ø–æ –¥–∞—Ç–µ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
      IFS=$'\n' backup_dirs=($(for d in "${backup_dirs[@]}"; do
        local name=$(echo "$d" | cut -d'|' -f1)
        local date=$(echo "$d" | cut -d'|' -f2)
        local type=$(echo "$d" | cut -d'|' -f3)
        echo "$date|$name|$type"
      done | sort -r | awk -F'|' '{print $2"|"$1"|"$3}'))
      unset IFS
      
      # –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ø–∏—è—Ö
      if [[ ${#backup_dirs[@]} -gt 0 ]]; then
        echo -e "${GREEN}‚úì –ù–∞–π–¥–µ–Ω–æ ${#backup_dirs[@]} —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:${RESET}"
        
        # –í—ã–≤–æ–¥–∏–º –º–∞–∫—Å–∏–º—É–º 5 –∫–æ–ø–∏–π
        local max_show=$((${#backup_dirs[@]} > 5 ? 5 : ${#backup_dirs[@]}))
        for ((i=0; i<$max_show; i++)); do
          local name=$(echo "${backup_dirs[$i]}" | cut -d'|' -f1)
          local date=$(echo "${backup_dirs[$i]}" | cut -d'|' -f2)
          local type=$(echo "${backup_dirs[$i]}" | cut -d'|' -f3)
          
          if [[ "$type" == "dir" ]]; then
            echo -e "  ${GREEN}‚Ä¢${RESET} $name - $date"
          else
            echo -e "  ${YELLOW}‚Ä¢${RESET} $name - $date (–∞—Ä—Ö–∏–≤)"
          fi
        done
        
        # –ï—Å–ª–∏ –±–æ–ª—å—à–µ 5 –∫–æ–ø–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥—Ä—É–≥–∏—Ö
        if [[ ${#backup_dirs[@]} -gt 5 ]]; then
          local remaining=$((${#backup_dirs[@]} - 5))
          echo -e "  ${GRAY}...–∏ –µ—â–µ $remaining –∫–æ–ø–∏–π${RESET}"
        fi
      else
        echo -e "${YELLOW}‚ö†Ô∏è  –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç${RESET}"
      fi
    fi
    
    # –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    
    # –ú–µ–Ω—é –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö —Ä–∞–º–æ–∫
    echo -e "${BLUE}üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:${RESET}"
    echo ""
    echo -e "  ${CYAN}1)${RESET} üì• –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é"
    
    # –ü—É–Ω–∫—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–ø–∏–∏
    if [[ ${#backup_dirs[@]} -gt 0 || -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" || -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]]; then
      echo -e "  ${CYAN}2)${RESET} üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"
    else
      echo -e "  ${GRAY}2)${RESET} ${GRAY}üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)${RESET}"
    fi
    
    # –ü—É–Ω–∫—Ç –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏
    if [[ ${#backup_dirs[@]} -gt 0 ]]; then
      echo -e "  ${CYAN}3)${RESET} üóúÔ∏è  –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏"
      echo -e "  ${CYAN}4)${RESET} üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏"
    else
      echo -e "  ${GRAY}3)${RESET} ${GRAY}üóúÔ∏è  –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)${RESET}"
      echo -e "  ${GRAY}4)${RESET} ${GRAY}üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)${RESET}"
    fi
    
    echo -e "  ${CYAN}5)${RESET} ‚öôÔ∏è  –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"
    echo -e "  ${CYAN}0)${RESET} üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
    
    # –ù–∏–∂–Ω—è—è –ª–∏–Ω–∏—è —Ä–∞–º–∫–∏
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    
    # –û—Ç—Å—Ç—É–ø –ø–æ—Å–ª–µ –º–µ–Ω—é
    echo ""
    
    # –ó–∞–ø—Ä–æ—Å –≤—ã–±–æ—Ä–∞
    choice=""
    read -p "üî¢ –í–∞—à –≤—ã–±–æ—Ä [0-5]: " choice
    
    case $choice in
      1) # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        create_backup
        ;;
      2) # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–ø–∏–∏
        if [[ ${#backup_dirs[@]} -gt 0 || -d "$BACKUP_DIR/$INITIAL_BACKUP_NAME" || -f "$BACKUP_DIR/${INITIAL_BACKUP_NAME}.tar.gz" ]]; then
          restore_backup
        else
          echo -e "\n${YELLOW}‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.${RESET}"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        fi
        ;;
      3) # –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ø–∏–∏
        if [[ ${#backup_dirs[@]} -gt 0 ]]; then
          archive_backup
        else
          echo -e "\n${YELLOW}‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏.${RESET}"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        fi
        ;;
      4) # –£–¥–∞–ª–∏—Ç—å –∫–æ–ø–∏–∏
        if [[ ${#backup_dirs[@]} -gt 0 ]]; then
          delete_backup
        else
          echo -e "\n${YELLOW}‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.${RESET}"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        fi
        ;;
      5) # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        configure_backup
        ;;
      0|q|Q|exit|quit) # –í—ã—Ö–æ–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        return 0
        ;;
      *) # –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä
        echo -e "\n${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.${RESET}"
        read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
        ;;
    esac
  done
}

# –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é –æ–ø—Ü–∏–π
show_menu() {
  local has_myshell=$([[ -d "$BASE_DIR" ]] && echo "true" || echo "false")
  local choice=""
  local confirm=""
  
  while true; do
    clear
    show_logo
    show_config_info
    
    echo -e "${BLUE}‚öôÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:${RESET}\n"
    
    if [[ "$has_myshell" == "true" ]]; then
      echo -e "  ${CYAN}1)${RESET} üîÑ –û–±–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ ${CYAN}MYSHELL${RESET}"
      echo -e "  ${CYAN}2)${RESET} üîÅ –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ ${CYAN}MYSHELL${RESET} (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫)"
      echo -e "  ${CYAN}3)${RESET} üÜï –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è ${CYAN}MYSHELL${RESET} (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫)"
      echo -e "  ${CYAN}4)${RESET} üß© –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–ª–∞–≥–∏–Ω—ã"
      echo -e "  ${CYAN}5)${RESET} üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏"
      echo -e "  ${CYAN}0)${RESET} üö™ –í—ã—Ö–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n"
    else
      echo -e "  ${CYAN}1)${RESET} üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ ${CYAN}MYSHELL${RESET}"
      echo -e "  ${CYAN}2)${RESET} üîê –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"
      echo -e "  ${CYAN}0)${RESET} üö™ –í—ã—Ö–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n"
    fi
    
    choice=""
    read -p "üî¢ –í–∞—à –≤—ã–±–æ—Ä [0-$([ "$has_myshell" == "true" ] && echo "5" || echo "2")]: " choice
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ –≤–≤–æ–¥–∞
    if [[ -z "$choice" ]]; then
      echo -e "\n${RED}‚ùå –ü—É—Å—Ç–æ–π –≤–≤–æ–¥. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.${RESET}"
      read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
      continue
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if [[ "$has_myshell" == "true" ]]; then
      case $choice in
        1) # –û–±–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
          ACTION="update"
          SAVE_EXISTING="y"
          ;;
        2) # –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫
          ACTION="reinstall"
          SAVE_EXISTING="y"
          ;;
        3) # –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
          ACTION="reinstall"
          SAVE_EXISTING="n"
          ;;
        4) # –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω—ã
          ACTION="plugins"
          SAVE_EXISTING="y"
          ;;
        5) # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
          ACTION="backup"
          SAVE_EXISTING="y"
          # –°—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ–º backup_menu –≤–º–µ—Å—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
          backup_menu
          continue
          ;;
        0|q|Q|exit|quit) # –í—ã—Ö–æ–¥
          echo -e "\n${GREEN}üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!${RESET}"
          exit 0
          ;;
        *) # –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä
          echo -e "\n${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.${RESET}"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
          continue
          ;;
      esac
    else
      case $choice in
        1) # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
          ACTION="install"
          SAVE_EXISTING="n"
          ;;
        2) # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
          ACTION="install"
          SAVE_EXISTING="y"
          ;;
        0|q|Q|exit|quit) # –í—ã—Ö–æ–¥
          echo -e "\n${GREEN}üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!${RESET}"
          exit 0
          ;;
        *) # –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä
          echo -e "\n${RED}‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.${RESET}"
          read -p "‚è≥ –ù–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." dummy
          continue
          ;;
      esac
    fi

    # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é —Ä–∞–º–∫—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏
    clear
    show_logo
    
    # –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è 
    local action_desc=$(get_action_description)
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–º–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    local action_title=""
    case $ACTION in
      "update") 
        action_title="–û–ë–ù–û–í–õ–ï–ù–ò–ï –û–ö–†–£–ñ–ï–ù–ò–Ø MYSHELL"
        ;;
      "reinstall") 
        if [[ "$SAVE_EXISTING" == "y" ]]; then
          action_title="–ü–ï–†–ï–£–°–¢–ê–ù–û–í–ö–ê –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –ù–ê–°–¢–†–û–ï–ö"
        else
          action_title="–ü–û–õ–ù–ê–Ø –ü–ï–†–ï–£–°–¢–ê–ù–û–í–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø"
        fi
        ;;
      "install")
        if [[ "$SAVE_EXISTING" == "y" ]]; then
          action_title="–£–°–¢–ê–ù–û–í–ö–ê –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –ù–ê–°–¢–†–û–ï–ö"
        else
          action_title="–ß–ò–°–¢–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø"
        fi
        ;;
      "plugins") 
        action_title="–û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–õ–ê–ì–ò–ù–û–í"
        ;;
      "backup") 
        action_title="–°–û–ó–î–ê–ù–ò–ï –†–ï–ó–ï–†–í–ù–û–ô –ö–û–ü–ò–ò"
        ;;
    esac
    
    # –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Ä–∞–º–∫–∏
    echo -e "${CYAN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${RESET}"
    echo -e "${CYAN}‚îÇ${RESET}               ${YELLOW}$action_title${RESET}               ${CYAN}‚îÇ${RESET}"
    echo -e "${CYAN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${RESET}"
    echo -e ""
    echo -e "${YELLOW}$(center_text "$action_desc")${RESET}"
    echo -e ""
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    echo -e ""


    # –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–Ω—ã–µ –±–ª–æ–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ä–∞–º–∫—É
    case $ACTION in
      "update") 
        echo -e "${BLUE}üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:${RESET}"                              
        IFS=$'\n'
        for line in $(show_environment_status); do
          echo -e "$line" | sed 's/\\n//g'
        done
        unset IFS
        echo -e ""                              
        echo -e "${BLUE}‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:${RESET}"
        echo -e "‚Ä¢ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π —Å GitHub."
        echo -e "‚Ä¢ –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã."
        echo -e "‚Ä¢ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —Å—Ä–∞–∑—É –∂–µ."
        ;;
        
      "reinstall") 
        echo -e "${BLUE}üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:${RESET}"
        IFS=$'\n'
        for line in $(show_environment_status); do
          echo -e "$line" | sed 's/\\n//g'
        done
        unset IFS
        
        echo -e ""
        echo -e "${BLUE}‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–µ:${RESET}"
        if [[ "$SAVE_EXISTING" == "y" ]]; then
          echo -e "‚Ä¢ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞."
          echo -e "‚Ä¢ –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ."
          echo -e "‚Ä¢ –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–ª–∞–≥–∏–Ω—ã –±—É–¥—É—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã."
        else
          echo -e "${RED}‚ö†Ô∏è  –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ù–ï –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞!${RESET}"
          echo -e "${RED}‚ö†Ô∏è  –í—Å–µ –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!${RESET}"
          echo -e "${RED}‚ö†Ô∏è  –û–∫—Ä—É–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å –Ω—É–ª—è!${RESET}"
        fi
        ;;
        
      "install")
        echo -e "${BLUE}üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:${RESET}"
        IFS=$'\n'
        for line in $(show_environment_status); do
          echo -e "$line" | sed 's/\\n//g'
        done
        unset IFS
        
        echo -e ""
        echo -e "${BLUE}‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ:${RESET}"
        if [[ "$SAVE_EXISTING" == "y" ]]; then
          echo -e "‚Ä¢ –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤–∞—à–∏—Ö —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫."
          echo -e "‚Ä¢ –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫."
          echo -e "‚Ä¢ –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Zsh."
        else
          echo -e "${RED}‚ö†Ô∏è  –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ù–ï –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞!${RESET}"
          echo -e "${RED}‚ö†Ô∏è  –í—Å–µ –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã!${RESET}"
          echo -e "‚Ä¢ –û–∫—Ä—É–∂–µ–Ω–∏–µ MYSHELL –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é."
        fi
        ;;
        
      "plugins") 
        echo -e "${BLUE}üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–≥–∏–Ω–∞—Ö:${RESET}"
        echo -e ""
        
        # –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –∏—Ö –≤–µ—Ä—Å–∏–∏
        if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" ]]; then
          local asg_version=$(cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" && git describe --tags 2>/dev/null || echo "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
          echo -e "${GREEN}‚úì zsh-autosuggestions${RESET} - –≤–µ—Ä—Å–∏—è: $asg_version"
        else
          echo -e "${RED}‚úó zsh-autosuggestions${RESET} - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        fi
        
        if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" ]]; then
          local syn_version=$(cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" && git describe --tags 2>/dev/null || echo "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
          echo -e "${GREEN}‚úì zsh-syntax-highlighting${RESET} - –≤–µ—Ä—Å–∏—è: $syn_version"
        else
          echo -e "${RED}‚úó zsh-syntax-highlighting${RESET} - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        fi
        
        if [[ -d "$VIM_COLORS_DIR/papercolor-theme" ]]; then
          local pc_version=$(cd "$VIM_COLORS_DIR/papercolor-theme" && git describe --tags 2>/dev/null || echo "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
          echo -e "${GREEN}‚úì PaperColor${RESET} - –≤–µ—Ä—Å–∏—è: $pc_version"
        else
          echo -e "${RED}‚úó PaperColor${RESET} - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        fi
        
        echo -e ""
        echo -e "${BLUE}‚ÑπÔ∏è  –û–ø–µ—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤:${RESET}"
        echo -e "‚Ä¢ –í—Å–µ –ø–ª–∞–≥–∏–Ω—ã –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π."
        echo -e "‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π."
        echo -e "‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –Ω–µ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏."
        ;;
        
      "backup") 
        echo -e "${BLUE}üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏—è—Ö:${RESET}"
        IFS=$'\n'
        for line in $(show_backup_info); do
          echo -e "$line" | sed 's/\\n//g'
        done
        unset IFS
        
        echo -e ""
        echo -e "${BLUE}‚ÑπÔ∏è  –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:${RESET}"
        echo -e "‚Ä¢ –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∫–æ–ø–∏—è —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è MYSHELL."
        echo -e "‚Ä¢ –ö–æ–ø–∏—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
        echo -e "$DATED_BACKUP_DIR"
        echo -e "–°—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏ –±—É–¥—É—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ ($MAX_BACKUPS)."
        ;;
    esac
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    echo -e "${BLUE}üìã –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:${RESET}"

    case $ACTION in
      "update"|"reinstall"|"install")
        echo -e "  ${GREEN}‚úì${RESET} Zsh/Oh-My-Zsh"
        echo -e "  ${GREEN}‚úì${RESET} Tmux"
        echo -e "  ${GREEN}‚úì${RESET} Vim"
        echo -e "  ${GREEN}‚úì${RESET} Dotfiles"
        echo -e "  ${GREEN}‚úì${RESET} –ü–ª–∞–≥–∏–Ω—ã"
        ;;
      "plugins")
        echo -e "  ${GREEN}‚úì${RESET} –ü–ª–∞–≥–∏–Ω—ã Zsh"
        echo -e "  ${GREEN}‚úì${RESET} –¢–µ–º—ã Vim"
        echo -e "  ${GRAY}‚úó${RESET} –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è)"
        ;;
      "backup")
        echo -e "  ${GREEN}‚úì${RESET} –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
        echo -e "  ${GREEN}‚úì${RESET} –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
        echo -e "  ${GREEN}‚úì${RESET} –ü–ª–∞–≥–∏–Ω—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è"
        ;;
    esac

    # –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Ä–∞–º–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    echo ""

    echo -e "${YELLOW}–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:${RESET} –ü–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ,"
    echo -e "–∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –≤–∞–∂–Ω—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ"
    echo -e "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏."
    echo ""
    echo -e "${CYAN}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${RESET}"
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    echo ""
    echo -en "${GREEN}‚ñ∂  –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): ${RESET}"
    confirm=""
    read confirm
    
    if [[ "$confirm" =~ ^[Yy]$ ]]; then
      clear
      echo -e "\n${GREEN}‚è≥ –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...${RESET}\n"
      break
    else
      # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é
      echo -e "\n${YELLOW}‚ö†Ô∏è  –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é...${RESET}"
      sleep 1
      continue
    fi
  done
}

#----------------------------------------------------
# üõ°Ô∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
#----------------------------------------------------

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
check_repo_availability() {
  local repo_url="$1"
  local repo_name="$2"
  
  # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–æ–º–µ–Ω –∏–∑ URL
  local domain=$(echo "$repo_url" | sed -E 's|^https?://([^/]+).*|\1|')
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞
  if ! ping -c 1 -W 3 "$domain" &>/dev/null; then
    print_warning "–î–æ–º–µ–Ω $domain –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è $repo_name" "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    return 1
  fi
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∞–º–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  if ! git ls-remote --quiet --exit-code "$repo_url" HEAD &>/dev/null; then
    print_warning "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π $repo_name" "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    return 1
  fi
  
  return 0
}

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º + –ª–æ–≤—É—à–∫–∞ –æ—à–∏–±–æ–∫
set -euo pipefail
trap 'echo -e "${RED}üö® –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ $LINENO. –ó–∞–≤–µ—Ä—à–∞–µ–º.${RESET}"; log_error "–û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ $LINENO"' ERR

# üîê –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø—É—Å–∫–∞ –æ—Ç root
if [[ "$EUID" -eq 0 ]]; then
  echo -e "${RED}‚ùå –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—Ç root. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å sudo.${RESET}"
  exit 1
fi

# üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
if ! ping -c 1 -W 3 1.1.1.1 &>/dev/null; then
  echo -e "${RED}‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å.${RESET}"
  exit 1
fi

# üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ GitHub
if ! curl -s -o /dev/null -I -L --fail --connect-timeout 5 https://github.com; then
  echo -e "${RED}‚ùå GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ –∏–ª–∏ VPN.${RESET}"
  exit 1
fi

# üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
print_group_header "üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤"

# –°–æ–∑–¥–∞–µ–º –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤: url => name
declare -A repos=(
  ["$GIT_DOTFILES_REPO"]="Dotfiles"
  ["$GIT_TMUX_REPO"]="Tmux"
  ["$GIT_OMZ_REPO"]="Oh-My-Zsh"
  ["$GIT_ZSH_AUTOSUGGESTIONS_REPO"]="ZSH Autosuggestions"
  ["$GIT_ZSH_SYNTAX_HIGHLIGHTING_REPO"]="ZSH Syntax Highlighting"
  ["$GIT_VIM_PAPERCOLOR_REPO"]="Vim PaperColor Theme"
)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
repo_errors=0
for repo_url in "${!repos[@]}"; do
  repo_name="${repos[$repo_url]}"
  if check_repo_availability "$repo_url" "$repo_name"; then
    print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è $repo_name" "–¥–æ—Å—Ç—É–ø–µ–Ω" "GREEN"
  else
    print_error "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è $repo_name" "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    repo_errors=$((repo_errors + 1))
  fi
done

# –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if [[ $repo_errors -gt 0 ]]; then
  echo -e "\n${YELLOW}‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ($repo_errors –∏–∑ ${#repos[@]})${RESET}"
  echo -e "${YELLOW}‚ö†Ô∏è –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.${RESET}"
  read -p "–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è? (y/n): " continue_anyway
  
  if [[ ! "$continue_anyway" =~ ^[Yy]$ ]]; then
    echo -e "${RED}‚ùå –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.${RESET}"
    exit 1
  fi
  
  echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É, –Ω–æ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –æ—à–∏–±–∫–∏...${RESET}"
fi

# üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∑–∞–ø—É—Å–∫–∞
if [[ "$CURRENT_DIR" != "$HOME_DIR" ]]; then
  echo -e "${RED}‚ùå –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $HOME_DIR${RESET}"
  echo -e "üìç –°–µ–π—á–∞—Å –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –∑–¥–µ—Å—å: $CURRENT_DIR"
  echo -e "‚ÑπÔ∏è –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: cd $HOME_DIR –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞."
  exit 1
fi

# üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ sudo
echo -e "${BLUE}üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ sudo...${RESET}"
if ! sudo -n true 2>/dev/null; then
  echo -e "${YELLOW}‚ö†Ô∏è –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ sudo.${RESET}"
  sudo -v || {
    echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∞ sudo. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ —É –≤–∞—Å —Ç–∞–∫–∏–µ –ø—Ä–∞–≤–∞.${RESET}"
    exit 1
  }
fi
echo -e "${GREEN}‚úÖ –ü—Ä–∞–≤–∞ sudo –¥–æ—Å—Ç—É–ø–Ω—ã${RESET}"

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
if [[ -f "$BASE_DIR/backup_config" ]]; then
  source "$BASE_DIR/backup_config"
  print_operation "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
fi

#----------------------------------------------------
# üñ•Ô∏è –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
#----------------------------------------------------

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
main() {
  clear
  show_logo
  show_config_info
  show_menu
  
  # –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –º–µ–Ω—é –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
  # –ü–æ –ª–æ–≥–∏–∫–µ, —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
}

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
main

#----------------------------------------------------
# üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
#----------------------------------------------------

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è backup - —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
if [[ "$ACTION" == "backup" ]]; then
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell
  if [[ ! -d "$BASE_DIR" ]]; then
    echo -e "${RED}‚ùå –û–∫—Ä—É–∂–µ–Ω–∏–µ .myshell –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å.${RESET}"
    exit 1
  fi
  
  # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
  if [[ -f "$BASE_DIR/backup_config" ]]; then
    source "$BASE_DIR/backup_config"
  fi
  
  # –í—ã–∑—ã–≤–∞–µ–º –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
  backup_menu
  exit 0
fi

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è plugins - —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤
if [[ "$ACTION" == "plugins" ]]; then
  print_group_header "üß© –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤"
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell
  if [[ ! -d "$BASE_DIR" ]]; then
    echo -e "${RED}‚ùå –û–∫—Ä—É–∂–µ–Ω–∏–µ .myshell –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.${RESET}"
    exit 1
  fi
  
  print_group_header "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è Zsh"
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ zsh-autosuggestions
  if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" ]]; then
    if ! (cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" && git pull -q); then
      print_operation "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º zsh-autosuggestions" "–ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞" "YELLOW"
      rm -rf "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions"
      if git clone -q "$GIT_ZSH_AUTOSUGGESTIONS_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions"; then
        print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-autosuggestions" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-autosuggestions" "–æ—à–∏–±–∫–∞"
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ zsh-autosuggestions" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    mkdir -p "$BASE_DIR/ohmyzsh/custom/plugins"
    if git clone -q "$GIT_ZSH_AUTOSUGGESTIONS_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions"; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-autosuggestions" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-autosuggestions" "–æ—à–∏–±–∫–∞"
    fi
  fi
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ zsh-syntax-highlighting
  if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" ]]; then
    if ! (cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" && git pull -q); then
      print_operation "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º zsh-syntax-highlighting" "–ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞" "YELLOW"
      rm -rf "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting"
      if git clone -q "$GIT_ZSH_SYNTAX_HIGHLIGHTING_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting"; then
        print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-syntax-highlighting" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-syntax-highlighting" "–æ—à–∏–±–∫–∞"
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ zsh-syntax-highlighting" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    mkdir -p "$BASE_DIR/ohmyzsh/custom/plugins"
    if git clone -q "$GIT_ZSH_SYNTAX_HIGHLIGHTING_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting"; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-syntax-highlighting" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ zsh-syntax-highlighting" "–æ—à–∏–±–∫–∞"
    fi
  fi
  
  print_group_header "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º—ã –¥–ª—è Vim"
  
  # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è vim, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
  if ! mkdir -p "$VIM_COLORS_DIR" "$VIM_PLUGINS_DIR"; then
    if sudo mkdir -p "$VIM_COLORS_DIR" "$VIM_PLUGINS_DIR"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è Vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è Vim" "–æ—à–∏–±–∫–∞"
    fi
  fi
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PaperColor —Ç–µ–º—ã
  if [[ -d "$VIM_COLORS_DIR/papercolor-theme" ]]; then
    if ! (cd "$VIM_COLORS_DIR/papercolor-theme" && git pull -q); then
      print_operation "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PaperColor —Ç–µ–º—É" "–ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞" "YELLOW"
      rm -rf "$VIM_COLORS_DIR/papercolor-theme"
      if git clone -q "$GIT_VIM_PAPERCOLOR_REPO" "$VIM_COLORS_DIR/papercolor-theme"; then
        print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ PaperColor —Ç–µ–º—ã" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
       print_error "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ PaperColor —Ç–µ–º—ã" "–æ—à–∏–±–∫–∞"
      fi
    else
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PaperColor —Ç–µ–º—ã" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
  else
    mkdir -p "$VIM_COLORS_DIR"
    if git clone -q "$GIT_VIM_PAPERCOLOR_REPO" "$VIM_COLORS_DIR/papercolor-theme"; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PaperColor —Ç–µ–º—ã" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PaperColor —Ç–µ–º—ã" "–æ—à–∏–±–∫–∞"
    fi
  fi
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏
  if ! ln -sf "$VIM_COLORS_DIR/papercolor-theme/colors/PaperColor.vim" "$VIM_COLORS_DIR/PaperColor.vim"; then
    if sudo ln -sf "$VIM_COLORS_DIR/papercolor-theme/colors/PaperColor.vim" "$VIM_COLORS_DIR/PaperColor.vim"; then
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "–æ—à–∏–±–∫–∞"
    fi
  else
    print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
  if ! sudo chown -R "$USER":"$USER" "$BASE_DIR"; then
    print_warning "–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞" "–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
  else
    print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  echo -e "${GREEN}üéâ –ü–ª–∞–≥–∏–Ω—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!${RESET}"
  exit 0
fi

#----------------------------------------------------
# üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
#----------------------------------------------------

print_group_header "üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
NEEDED_PACKAGES=()
for pkg in $PACKAGES; do
  if ! dpkg -s "$pkg" &>/dev/null; then
    NEEDED_PACKAGES+=("$pkg")
  fi
done

if [[ ${#NEEDED_PACKAGES[@]} -gt 0 ]]; then
  print_operation "–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤" "${NEEDED_PACKAGES[*]}" "YELLOW"
  
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–∞–∫–µ—Ç–æ–≤
  print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–∞–∫–µ—Ç–æ–≤" "apt update" "CYAN"
  if ! sudo apt update; then
    print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–∞–∫–µ—Ç–æ–≤" "–æ—à–∏–±–∫–∞"
    echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –ø–∞–∫–µ—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∞ sudo.${RESET}"
    exit 1
  fi
  
  # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
  print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤" "${NEEDED_PACKAGES[*]}" "CYAN"
  if ! sudo apt install -y "${NEEDED_PACKAGES[@]}"; then
    print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤" "–æ—à–∏–±–∫–∞"
    echo -e "${RED}‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∞ sudo.${RESET}"
    exit 1
  else
    print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
else
  print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤" "–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è" "GREEN"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è .myshell" "–≤—ã–ø–æ–ª–Ω–µ–Ω–æ" "CYAN"
if [[ -d "$BASE_DIR" ]]; then
  print_operation "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏–µ .myshell" "—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞" "YELLOW"
  
  if [[ "$SAVE_EXISTING" == "y" ]]; then
    # –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –±—ç–∫–∞–ø—ã
    archive_previous_backups
    
    # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–∞–ø–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞
    if ! mkdir -p "$DATED_BACKUP_DIR"; then
      if sudo mkdir -p "$DATED_BACKUP_DIR"; then
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "–æ—à–∏–±–∫–∞"
        exit 1
      fi
    else
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    local myshell_size=$(du -sm "$BASE_DIR" 2>/dev/null | cut -f1 || echo "100")
    if ! check_disk_space "$BACKUP_DIR" $((myshell_size + 200)); then
      print_warning "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
    else
      # –ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ .myshell (–∫—Ä–æ–º–µ –ø–∞–ø–∫–∏ backup)
      if ! rsync -a --exclude 'backup/' "$BASE_DIR/" "$DATED_BACKUP_DIR/"; then
        if sudo rsync -a --exclude 'backup/' "$BASE_DIR/" "$DATED_BACKUP_DIR/"; then
          print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "–æ—à–∏–±–∫–∞"
          exit 1
        fi
      else
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
      
      # –î–æ–±–∞–≤–ª—è–µ–º README –≤ –±—ç–∫–∞–ø
      cat > "$DATED_BACKUP_DIR/README.md" << EOF
# Backup of MYSHELL environment
Created: $(date)
Original directory: $BASE_DIR

## Contents:
$(find "$DATED_BACKUP_DIR" -type d -mindepth 1 -maxdepth 1 | sort | sed 's/^/- /')
EOF
    fi
  else
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–ø—Ä–æ–ø—É—â–µ–Ω–æ" "YELLOW"
  fi
else
  print_operation "–û–∫—Ä—É–∂–µ–Ω–∏–µ .myshell –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ" "–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ" "CYAN"
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
  EXISTING_CONFIGS=""
  [[ -f "$HOME/.zshrc" || -d "$HOME/.oh-my-zsh" ]] && EXISTING_CONFIGS="${EXISTING_CONFIGS}ZSH "
  [[ -f "$HOME/.tmux.conf" || -f "$HOME/.tmux.conf.local" ]] && EXISTING_CONFIGS="${EXISTING_CONFIGS}TMUX "
  [[ -f "$HOME/.vimrc" || -d "$HOME/.vim" ]] && EXISTING_CONFIGS="${EXISTING_CONFIGS}VIM "
  
  if [[ -n "$EXISTING_CONFIGS" ]]; then
    print_operation "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" "$EXISTING_CONFIGS" "YELLOW"
    
    if [[ "$SAVE_EXISTING" == "y" ]]; then
      # –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .myshell
      if ! mkdir -p "$BASE_DIR"; then
        if sudo mkdir -p "$BASE_DIR"; then
          print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
          exit 1
        fi
      else
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
      
      # –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
      if ! mkdir -p "$BACKUP_DIR"; then
        if sudo mkdir -p "$BACKUP_DIR"; then
          print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "–æ—à–∏–±–∫–∞"
          exit 1
        fi
      else
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
      
      # –ò –Ω–∞–∫–æ–Ω–µ—Ü, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞
      if ! mkdir -p "$DATED_BACKUP_DIR"; then
        if sudo mkdir -p "$DATED_BACKUP_DIR"; then
          print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "–æ—à–∏–±–∫–∞"
          exit 1
        fi
      else
        print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±—ç–∫–∞–ø–∞" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
copy_with_deref() {
  local src="$1"
  local dst="$2"
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
  if [[ ! -e "$src" && ! -L "$src" ]]; then
    print_warning "–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" "$src"
    return 1
  fi
  
  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
  if [[ -L "$src" ]]; then
    # –≠—Ç–æ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞
    local target=$(readlink -f "$src")
    if [[ ! -e "$target" ]]; then
      print_warning "–ë–∏—Ç–∞—è —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞" "$src"
      return 1
    fi
    
    if [[ -d "$target" ]]; then
      # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫–∞
      if ! cp -a "$target/." "$dst/"; then
        if sudo cp -a "$target/." "$dst/"; then
          print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ" "$src" "GREEN"
          return 0
        else
          print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ" "$src"
          return 1
        fi
      else
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ" "$src" "GREEN"
        return 0
      fi
    elif [[ -f "$target" ]]; then
      # –§–∞–π–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫–∞
      if [[ ! -s "$target" ]]; then
        print_warning "–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª –ø–æ —Å—Å—ã–ª–∫–µ" "$src"
        return 1
      fi
      
      if ! cp -a "$target" "$dst"; then
        if sudo cp -a "$target" "$dst"; then
          print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ" "$src" "GREEN"
          return 0
        else
          print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ" "$src"
          return 1
        fi
      else
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ" "$src" "GREEN"
        return 0
      fi
    else
      print_warning "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ —Å—Å—ã–ª–∫–µ" "$src"
      return 1
    fi
  elif [[ -d "$src" ]]; then
    # –≠—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
    if ! cp -a "$src/." "$dst/"; then
      if sudo cp -a "$src/." "$dst/"; then
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "$src" "GREEN"
        return 0
      else
        print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "$src"
        return 1
      fi
    else
      print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "$src" "GREEN"
      return 0
    fi
  elif [[ -f "$src" ]]; then
    # –≠—Ç–æ —Ñ–∞–π–ª
    if [[ ! -s "$src" ]]; then
      print_warning "–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª" "$src"
      return 1
    fi
    
    if ! cp -a "$src" "$dst"; then
      if sudo cp -a "$src" "$dst"; then
        print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞" "$src" "GREEN"
        return 0
      else
        print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞" "$src"
        return 1
      fi
    else
      print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞" "$src" "GREEN"
      return 0
    fi
  else
    print_warning "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞" "$src"
    return 1
  fi
}

      # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
      if [[ "$EXISTING_CONFIGS" == *"ZSH"* ]]; then
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ZSH" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        mkdir -p "$DATED_BACKUP_DIR/zsh"
        
        if [[ -e "$HOME/.zshrc" ]]; then
          copy_with_deref "$HOME/.zshrc" "$DATED_BACKUP_DIR/zsh/"
        fi
        
        if [[ -d "$HOME/.oh-my-zsh" ]]; then
          if [[ -L "$HOME/.oh-my-zsh" ]]; then
            local omz_target=$(readlink -f "$HOME/.oh-my-zsh")
            if [[ -d "$omz_target" ]]; then
              if ! cp -a "$omz_target" "$DATED_BACKUP_DIR/zsh/oh-my-zsh"; then
                if sudo cp -a "$omz_target" "$DATED_BACKUP_DIR/zsh/oh-my-zsh"; then
                  print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh -> $omz_target" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                else
                  print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh -> $omz_target" "–æ—à–∏–±–∫–∞"
                fi
              else
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh -> $omz_target" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              fi
            else
              print_warning "–°—Å—ã–ª–∫–∞ .oh-my-zsh —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é" "$omz_target"
            fi
          else
            if ! cp -a "$HOME/.oh-my-zsh" "$DATED_BACKUP_DIR/zsh/"; then
              if sudo cp -a "$HOME/.oh-my-zsh" "$DATED_BACKUP_DIR/zsh/"; then
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
                print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh" "–æ—à–∏–±–∫–∞"
              fi
            else
              print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .oh-my-zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            fi
          fi
        fi
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ZSH" "–∑–∞–≤–µ—Ä—à–µ–Ω–æ" "GREEN"
      fi
  
      if [[ "$EXISTING_CONFIGS" == *"TMUX"* ]]; then
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TMUX" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        mkdir -p "$DATED_BACKUP_DIR/tmux"
        
        [[ -e "$HOME/.tmux.conf" ]] && copy_with_deref "$HOME/.tmux.conf" "$DATED_BACKUP_DIR/tmux/"
        [[ -e "$HOME/.tmux.conf.local" ]] && copy_with_deref "$HOME/.tmux.conf.local" "$DATED_BACKUP_DIR/tmux/"
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TMUX" "–∑–∞–≤–µ—Ä—à–µ–Ω–æ" "GREEN"
      fi
  
      if [[ "$EXISTING_CONFIGS" == *"VIM"* ]]; then
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VIM" "–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è" "CYAN"
        mkdir -p "$DATED_BACKUP_DIR/vim"
        
        [[ -e "$HOME/.vimrc" ]] && copy_with_deref "$HOME/.vimrc" "$DATED_BACKUP_DIR/vim/"
        
        if [[ -d "$HOME/.vim" || -L "$HOME/.vim" ]]; then
          if [[ -L "$HOME/.vim" ]]; then
            local vim_target=$(readlink -f "$HOME/.vim")
            if [[ -d "$vim_target" ]]; then
              if ! cp -a "$vim_target" "$DATED_BACKUP_DIR/vim/vim"; then
                if sudo cp -a "$vim_target" "$DATED_BACKUP_DIR/vim/vim"; then
                  print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim -> $vim_target" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
                else
                  print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim -> $vim_target" "–æ—à–∏–±–∫–∞"
                fi
              else
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim -> $vim_target" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              fi
            else
              print_warning "–°—Å—ã–ª–∫–∞ .vim —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é" "$vim_target"
            fi
          else
            if ! cp -a "$HOME/.vim" "$DATED_BACKUP_DIR/vim/"; then
              if sudo cp -a "$HOME/.vim" "$DATED_BACKUP_DIR/vim/"; then
                print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
              else
               print_error "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim" "–æ—à–∏–±–∫–∞"
              fi
            else
              print_operation "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ .vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            fi
          fi
        fi
        print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VIM" "–∑–∞–≤–µ—Ä—à–µ–Ω–æ" "GREEN"
      fi
      
      # –î–æ–±–∞–≤–ª—è–µ–º README –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–ø–∏—é
      cat > "$DATED_BACKUP_DIR/README.md" << EOF
# Backup of original configuration files before MYSHELL installation
Created: $(date)

## Contents:
$(find "$DATED_BACKUP_DIR" -type d -mindepth 1 -maxdepth 1 | sort | sed 's/^/- /')
EOF
      
      print_success "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π" "—É—Å–ø–µ—à–Ω–æ"
    else
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" "–ø—Ä–æ–ø—É—â–µ–Ω–æ" "YELLOW"
    fi
  else
    print_operation "–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" "–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã" "GREEN"
  fi
  
  # –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  if ! mkdir -p "$BASE_DIR"; then
    if sudo mkdir -p "$BASE_DIR"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
      exit 1
    fi
  else
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
fi

#----------------------------------------------------
# üßπ –û—á–∏—Å—Ç–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
#----------------------------------------------------

# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –±–ª–æ–∫–∏, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ - update (–Ω–µ –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é)
if [[ "$ACTION" != "update" ]]; then
  print_group_header "üßπ –û—á–∏—Å—Ç–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
  
  # –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell (–∫—Ä–æ–º–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backup)
  if ! find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 rm -rf 2>/dev/null; then
    if sudo find "$BASE_DIR" -mindepth 1 ! -path "$BACKUP_DIR" ! -path "$BACKUP_DIR/*" -print0 | xargs -0 sudo rm -rf; then
      print_operation "–û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
    fi
  else
    print_operation "–û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
  
  # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
  clean_item() {
    local item="$1"
    local target="$HOME/$item"
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
    if [[ ! -e "$target" && ! -L "$target" ]]; then
      return 0
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
    if [[ -w "$(dirname "$target")" ]]; then
      use_sudo=false
    else
      use_sudo=true
      print_warning "–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é $(dirname "$target")" "–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω sudo"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ —É–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ
    if [[ -L "$target" ]]; then
      if $use_sudo; then
        if sudo rm "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏: $item" "–æ—à–∏–±–∫–∞"
        fi
      else
        if rm "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏: $item" "–æ—à–∏–±–∫–∞"
        fi
      fi
    elif [[ -f "$target" ]]; then
      if $use_sudo; then
        if sudo rm "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: $item" "–æ—à–∏–±–∫–∞"
        fi
      else
        if rm "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: $item" "–æ—à–∏–±–∫–∞"
        fi
      fi
    elif [[ -d "$target" ]]; then
      if $use_sudo; then
        if sudo rm -rf "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $item" "–æ—à–∏–±–∫–∞"
        fi
      else
        if rm -rf "$target"; then
          print_operation "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $item" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $item" "–æ—à–∏–±–∫–∞"
        fi
      fi
    else
      print_warning "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞: $item" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
    fi
  }
  
  # –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ —Å–∏–º–ª–∏–Ω–∫–æ–≤
  echo -e "  ${BLUE}‚îî‚îÄ‚Üí –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:${RESET}"

  # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –Ω–∞–¥–æ —É–¥–∞–ª–∏—Ç—å
  declare -a files_to_remove=()
  for item in $TRASH; do
    for target in $HOME/$item; do
      if [[ -e "$target" || -L "$target" ]]; then
        files_to_remove+=("$(basename "$target")")
      fi
    done
  done

  # –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
  if [ ${#files_to_remove[@]} -eq 0 ]; then
    print_operation "–°—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã" "–Ω–µ –Ω–∞–π–¥–µ–Ω—ã" "GREEN"
  else
    # –£–¥–∞–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    for base_item in "${files_to_remove[@]}"; do
      clean_item "$base_item"
    done
    
    # –í –∫–æ–Ω—Ü–µ –≤—ã–≤–æ–¥–∏–º –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    print_operation "–í—Å–µ–≥–æ —É–¥–∞–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤" "${#files_to_remove[@]}" "GREEN"
  fi
fi

#----------------------------------------------------
# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
#----------------------------------------------------

print_group_header "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"

# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
update_or_clone_repo() {
  local repo_url="$1"
  local target_dir="$2"
  local repo_name="$3"
  local depth_param="$4" # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≥–ª—É–±–∏–Ω—ã –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  if ! git ls-remote --quiet --exit-code "$repo_url" HEAD &>/dev/null; then
    print_warning "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π $repo_name –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" "–ø—Ä–æ–ø—É—Å–∫"
    return 1
  fi
  
  if [[ -d "$target_dir" && -d "$target_dir/.git" ]]; then
    # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —ç—Ç–æ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    
    # –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º fetch, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
    if ! (cd "$target_dir" && git fetch --quiet); then
      if ! sudo -u "$USER" git -C "$target_dir" fetch --quiet; then
        print_warning "–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å fetch –¥–ª—è $repo_name" "–ø–æ–ø—ã—Ç–∫–∞ pull"
        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
      fi
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç—Å—Ç–∞—ë—Ç –ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –æ—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–π
    local local_commit=$(cd "$target_dir" && git rev-parse HEAD 2>/dev/null || echo "")
    local remote_commit=$(cd "$target_dir" && git rev-parse FETCH_HEAD 2>/dev/null || echo "")
    
    if [[ "$local_commit" == "$remote_commit" && -n "$local_commit" ]]; then
      # –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç—É—Å –æ–± –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
      print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ $repo_name" "–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è" "GREEN"
    else
      # –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º
      if ! (cd "$target_dir" && git pull --quiet); then
        if sudo -u "$USER" git -C "$target_dir" pull --quiet; then
          print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ $repo_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ $repo_name" "–æ—à–∏–±–∫–∞"
          
          # –í —Å–ª—É—á–∞–µ —Å–µ—Ä—å–µ–∑–Ω–æ–π –æ—à–∏–±–∫–∏, –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
          print_operation "–ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ $repo_name" "—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏" "YELLOW"
          rm -rf "$target_dir" || sudo rm -rf "$target_dir"
          
          # –ö–ª–æ–Ω–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ
          local depth_option=""
          [[ -n "$depth_param" ]] && depth_option="--depth=$depth_param"
          
          if git clone $depth_option --quiet "$repo_url" "$target_dir"; then
            print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ $repo_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
          else
            if sudo git clone $depth_option --quiet "$repo_url" "$target_dir"; then
              print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ $repo_name —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
            else
              print_error "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ $repo_name" "–æ—à–∏–±–∫–∞"
              return 1
            fi
          fi
        fi
      else
        print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ $repo_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      fi
    fi
  else
    # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º, –∫–ª–æ–Ω–∏—Ä—É–µ–º
    
    # –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º, —É–¥–∞–ª—è–µ–º –µ—ë
    if [[ -d "$target_dir" ]]; then
      rm -rf "$target_dir" || sudo rm -rf "$target_dir"
    fi
    
    # –°–æ–∑–¥–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    local parent_dir=$(dirname "$target_dir")
    if [[ ! -d "$parent_dir" ]]; then
      if ! mkdir -p "$parent_dir"; then
        if ! sudo mkdir -p "$parent_dir"; then
          print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ $parent_dir" "–æ—à–∏–±–∫–∞"
          return 1
        fi
      fi
    fi
    
    # –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    local depth_option=""
    [[ -n "$depth_param" ]] && depth_option="--depth=$depth_param"
    
    if git clone $depth_option --quiet "$repo_url" "$target_dir"; then
      print_operation "–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ $repo_name" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      if sudo git clone $depth_option --quiet "$repo_url" "$target_dir"; then
        print_operation "–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ $repo_name —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
        sudo chown -R "$USER":"$USER" "$target_dir"
      else
        print_error "–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ $repo_name" "–æ—à–∏–±–∫–∞"
        return 1
      fi
    fi
  fi
  
  return 0
}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh
if [[ "$ACTION" == "update" ]]; then
  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Oh-My-Zsh
  if [[ -d "$BASE_DIR/ohmyzsh" ]]; then
    if (cd "$BASE_DIR/ohmyzsh" && git pull --quiet); then
      print_operation "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Oh-My-Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Oh-My-Zsh" "–æ—à–∏–±–∫–∞"
      
      # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
      print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "–Ω–∞—á–∞–ª–æ" "YELLOW"
      rm -rf "$BASE_DIR/ohmyzsh" || sudo rm -rf "$BASE_DIR/ohmyzsh"
      
      if ! mkdir -p "$BASE_DIR/ohmyzsh"; then
        if sudo mkdir -p "$BASE_DIR/ohmyzsh"; then
          print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è Oh-My-Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
        else
          print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è Oh-My-Zsh" "–æ—à–∏–±–∫–∞"
        fi
      fi
      
      if git clone --depth=1 --quiet "$GIT_OMZ_REPO" "$BASE_DIR/ohmyzsh"; then
        print_operation "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "–æ—à–∏–±–∫–∞"
      fi
    fi
  else
    print_operation "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Oh-My-Zsh –Ω–µ –Ω–∞–π–¥–µ–Ω–∞" "–±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞" "YELLOW"
    mkdir -p "$BASE_DIR/ohmyzsh" || sudo mkdir -p "$BASE_DIR/ohmyzsh"
    if git clone --depth=1 --quiet "$GIT_OMZ_REPO" "$BASE_DIR/ohmyzsh"; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "–æ—à–∏–±–∫–∞"
    fi
  fi
else
  # –ù–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh
  mkdir -p "$BASE_DIR/ohmyzsh" || sudo mkdir -p "$BASE_DIR/ohmyzsh"
  if git clone --depth=1 --quiet "$GIT_OMZ_REPO" "$BASE_DIR/ohmyzsh"; then
    print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  else
    print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Oh-My-Zsh" "–æ—à–∏–±–∫–∞"
  fi
fi

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
update_or_clone_repo "$GIT_TMUX_REPO" "$BASE_DIR/tmux" "tmux –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" "1"
update_or_clone_repo "$GIT_DOTFILES_REPO" "$BASE_DIR/dotfiles" "dotfiles" "1"

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è vim
if mkdir -p "$VIM_COLORS_DIR" "$VIM_PLUGINS_DIR"; then
  print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è vim" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
else
  if sudo mkdir -p "$VIM_COLORS_DIR" "$VIM_PLUGINS_DIR"; then
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è vim —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  else
    print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è vim" "–æ—à–∏–±–∫–∞"
  fi
fi

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ PaperColor —Ç–µ–º—ã
update_or_clone_repo "$GIT_VIM_PAPERCOLOR_REPO" "$VIM_COLORS_DIR/papercolor-theme" "PaperColor —Ç–µ–º—ã" "1"

#----------------------------------------------------
# üß© –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
#----------------------------------------------------

print_group_header "üß© –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤"

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤ Zsh
if mkdir -p "$BASE_DIR/ohmyzsh/custom/plugins"; then
  print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤ Zsh" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
else
  if sudo mkdir -p "$BASE_DIR/ohmyzsh/custom/plugins"; then
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤ Zsh —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  else
    print_error "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤ Zsh" "–æ—à–∏–±–∫–∞"
  fi
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤ Zsh
update_or_clone_repo "$GIT_ZSH_AUTOSUGGESTIONS_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" "–ø–ª–∞–≥–∏–Ω–∞ zsh-autosuggestions" "1"
update_or_clone_repo "$GIT_ZSH_SYNTAX_HIGHLIGHTING_REPO" "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" "–ø–ª–∞–≥–∏–Ω–∞ zsh-syntax-highlighting" "1"

#----------------------------------------------------
# ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
#----------------------------------------------------

print_group_header "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor
if [[ -d "$VIM_COLORS_DIR/papercolor-theme" && -f "$VIM_COLORS_DIR/papercolor-theme/colors/PaperColor.vim" ]]; then
  if ! ln -sf "$VIM_COLORS_DIR/papercolor-theme/colors/PaperColor.vim" "$VIM_COLORS_DIR/PaperColor.vim"; then
    if sudo ln -sf "$VIM_COLORS_DIR/papercolor-theme/colors/PaperColor.vim" "$VIM_COLORS_DIR/PaperColor.vim"; then
      print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_error "–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "–æ—à–∏–±–∫–∞"
    fi
  else
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è PaperColor" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  fi
else
  print_warning "–§–∞–π–ª PaperColor.vim –Ω–µ –Ω–∞–π–¥–µ–Ω" "—Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"
fi

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
update_symlinks

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤–µ—Ä—Å–∏–∏
if echo "$SCRIPT_VERSION" > "$BASE_DIR/version"; then
  print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤–µ—Ä—Å–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
else
  if echo "$SCRIPT_VERSION" | sudo tee "$BASE_DIR/version" > /dev/null; then
    print_operation "–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤–µ—Ä—Å–∏–∏ —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
  else
    print_error "–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤–µ—Ä—Å–∏–∏" "–æ—à–∏–±–∫–∞"
  fi
fi

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª
{
  echo "# MYSHELL Components Versions"
  echo "# Generated: $(date)"
  echo "MYSHELL_VERSION=\"$SCRIPT_VERSION\""
  
  if [[ -d "$BASE_DIR/ohmyzsh" ]]; then
    local omz_ver=$(cd "$BASE_DIR/ohmyzsh" && git describe --tags 2>/dev/null || echo "unknown")
    echo "OH_MY_ZSH_VERSION=\"$omz_ver\""
  fi
  
  if [[ -d "$BASE_DIR/tmux" ]]; then
    local tmux_ver=$(cd "$BASE_DIR/tmux" && git describe --tags 2>/dev/null || echo "unknown")
    echo "TMUX_CONFIG_VERSION=\"$tmux_ver\""
  fi
  
  if [[ -d "$BASE_DIR/dotfiles" ]]; then
    local dotfiles_ver=$(cd "$BASE_DIR/dotfiles" && git describe --tags 2>/dev/null || echo "unknown")
    echo "DOTFILES_VERSION=\"$dotfiles_ver\""
  fi
  
  if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" ]]; then
    local asg_ver=$(cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-autosuggestions" && git describe --tags 2>/dev/null || echo "unknown")
    echo "ZSH_AUTOSUGGESTIONS_VERSION=\"$asg_ver\""
  fi
  
  if [[ -d "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" ]]; then
    local syn_ver=$(cd "$BASE_DIR/ohmyzsh/custom/plugins/zsh-syntax-highlighting" && git describe --tags 2>/dev/null || echo "unknown")
    echo "ZSH_SYNTAX_HIGHLIGHTING_VERSION=\"$syn_ver\""
  fi
  
  if [[ -d "$VIM_COLORS_DIR/papercolor-theme" ]]; then
    local pc_ver=$(cd "$VIM_COLORS_DIR/papercolor-theme" && git describe --tags 2>/dev/null || echo "unknown")
    echo "VIM_PAPERCOLOR_VERSION=\"$pc_ver\""
  fi
} > "$BASE_DIR/components_versions"

print_operation "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤" "—É—Å–ø–µ—à–Ω–æ" "GREEN"

#----------------------------------------------------
# üß∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ZShell –∫–∞–∫ –æ–±–æ–ª–æ—á–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
#----------------------------------------------------

print_group_header "üß∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ZShell –∫–∞–∫ –æ–±–æ–ª–æ—á–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"

if [[ "$(basename "$SHELL")" != "zsh" ]]; then
  ZSH_PATH=$(which zsh 2>/dev/null)
  
  if [[ -z "$ZSH_PATH" ]]; then
    print_error "–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª zsh" "–Ω–µ –Ω–∞–π–¥–µ–Ω"
    print_warning "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Zsh –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" "–ø—Ä–æ–ø—É—â–µ–Ω–æ"
  else
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ zsh –≤ /etc/shells
    if ! grep -q "$ZSH_PATH" /etc/shells; then
      if echo "$ZSH_PATH" | sudo tee -a /etc/shells > /dev/null; then
        print_operation "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ zsh –≤ /etc/shells" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ zsh –≤ /etc/shells" "–æ—à–∏–±–∫–∞"
      fi
    else
      print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è zsh –≤ /etc/shells" "—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω" "GREEN"
    fi
    
    # –ú–µ–Ω—è–µ–º –æ–±–æ–ª–æ—á–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    if chsh -s "$ZSH_PATH" 2>/dev/null; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Zsh –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      if sudo chsh -s "$ZSH_PATH" "$USER"; then
        print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Zsh –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å sudo" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
      else
        print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Zsh –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" "–æ—à–∏–±–∫–∞"
      fi
    fi
  fi
else
  print_operation "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –æ–±–æ–ª–æ—á–∫–∏" "Zsh —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è" "GREEN"
fi

#----------------------------------------------------
# ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
#----------------------------------------------------

print_group_header "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
if sudo chown -R "$USER":"$USER" "$BASE_DIR"; then
  print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
else
  print_error "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ .myshell" "–æ—à–∏–±–∫–∞"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø—Ä–∞–≤
for link in "$HOME/.oh-my-zsh" "$HOME/.vim" "$HOME/.zshrc" "$HOME/.vimrc" "$HOME/.tmux.conf" "$HOME/.tmux.conf.local"; do
  if [[ -L "$link" ]]; then
    if sudo chown -h "$USER":"$USER" "$link" 2>/dev/null; then
      print_operation "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è $link" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
    else
      print_warning "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è $link" "–æ—à–∏–±–∫–∞"
    fi
  fi
done

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if rm -rf "$HOME/init-shell" 2>/dev/null || sudo rm -rf "$HOME/init-shell"; then
  print_operation "–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "—É—Å–ø–µ—à–Ω–æ" "GREEN"
else
  print_warning "–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏" "–æ—à–∏–±–∫–∞"
fi

#----------------------------------------------------
# üèÅ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
#----------------------------------------------------

# –ö—Ä–∞—Å–∏–≤–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
echo ""
echo -e "${GREEN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${RESET}"
echo -e "${GREEN}‚îÇ${RESET}$(center_text "${GREEN}üéâ  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!  üéâ${RESET}")${GREEN}‚îÇ${RESET}"
echo -e "${GREEN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${RESET}"
echo ""

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Ä–∞–º–∫–µ
echo -e "${BLUE}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê${RESET}"
echo -e "${BLUE}‚îÇ  ‚ÑπÔ∏è  –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É:                               ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ                                                                    ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ  ‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª                                          ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ             –∏–ª–∏                                                    ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ  ‚Ä¢ –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: ${CYAN}exec zsh${BLUE}                                  ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ                                                                    ‚îÇ${RESET}"
echo -e "${BLUE}‚îÇ  üöÄ –•–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –≤ Zsh –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? (y/n): ${RESET}"
switch_to_zsh=""
read switch_to_zsh
echo -e "${BLUE}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò${RESET}"
echo ""

if [[ "$switch_to_zsh" =~ ^[Yy]$ ]]; then
  echo -e "${GREEN}üëã –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ Zsh...${RESET}"
  exec zsh -l
else
  echo -e "${GREEN}üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!${RESET}"
fi



                

  

          
